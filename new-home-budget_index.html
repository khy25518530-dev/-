<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ  ìš°ë¦¬ì§‘ ì…ì£¼ ì¤€ë¹„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-bottom: 2px solid #e0e0e0;
            position: sticky;
            top: 70px;
            z-index: 99;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            min-width: 70px;
            padding: 15px 10px;
            background: none;
            border: none;
            font-size: 13px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #f8f9ff;
        }
        
        .content {
            padding: 15px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .card-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .dday-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .dday-number {
            font-size: 48px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: white;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .amount-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .amount-row:last-child {
            border-bottom: none;
        }
        
        .amount-label {
            color: #666;
            font-size: 14px;
        }
        
        .amount-value {
            font-weight: bold;
            font-size: 16px;
        }
        
        .total-row {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }
        
        .total-amount {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .status-card {
            text-align: center;
            padding: 25px;
        }
        
        .status-card.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        
        .status-card.warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .status-amount {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
            display: block;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        input[type="number"] {
            text-align: right;
        }
        
        input[type="file"] {
            padding: 10px;
            font-size: 13px;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        .btn-delete {
            background: #ff4757;
            color: white;
            padding: 8px 15px;
            font-size: 13px;
            width: auto;
        }
        
        .item-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }
        
        .item-title {
            font-weight: bold;
            font-size: 16px;
        }
        
        .item-status {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 20px;
            background: #e0e0e0;
        }
        
        .status-done {
            background: #d4edda;
            color: #155724;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .btn-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-row button {
            flex: 1;
        }
        
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }
        
        .category-header {
            font-size: 15px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0 10px 5px;
        }
        
        .savings-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .savings-input input {
            flex: 1;
        }
        
        .savings-input button {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .month-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
        }
        
        .month-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
        }
        
        .current-month {
            font-size: 18px;
            font-weight: bold;
        }
        
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 25px;
        }
        
        .timeline-item:before {
            content: '';
            position: absolute;
            left: -24px;
            top: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #667eea;
        }
        
        .timeline-item.done:before {
            background: #38ef7d;
            box-shadow: 0 0 0 2px #38ef7d;
        }
        
        .timeline-line {
            position: absolute;
            left: -18px;
            top: 20px;
            bottom: 0;
            width: 2px;
            background: #e0e0e0;
        }
        
        .receipt-img {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .mini-card {
            background: #f8f9ff;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ  ìš°ë¦¬ì§‘ ì…ì£¼ ì¤€ë¹„</h1>
        <div style="font-size: 14px; opacity: 0.9; margin-top: 5px;">ì²´ê³„ì ì¸ ìê¸ˆ ê´€ë¦¬</div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="showTab('home')">ëŒ€ì‹œë³´ë“œ</button>
        <button class="tab" onclick="showTab('expenses')">ì§€ì¶œ</button>
        <button class="tab" onclick="showTab('savings')">ìê¸ˆí˜„í™©</button>
        <button class="tab" onclick="showTab('schedule')">ì¼ì •</button>
    </div>

    <div class="content">
        <!-- í™ˆ íƒ­ -->
        <div id="home" class="tab-content active">
            <!-- ìµœì¢… ìƒíƒœ ì¹´ë“œ -->
            <div class="card status-card" id="home-final-status" style="margin-bottom: 15px;">
                <div style="font-size: 18px; font-weight: 600; opacity: 0.95; margin-bottom: 5px;">ğŸ’° ì§€ê¸ˆ ìƒíƒœëŠ”?</div>
                <div class="status-amount" id="home-final-amount" style="font-size: 42px; margin: 15px 0;">0ì›</div>
                <div id="home-final-text" style="font-size: 16px; font-weight: 500;">ê³„ì‚° ì¤‘...</div>
            </div>

            <!-- í†µí•© ë§‰ëŒ€ ê·¸ë˜í”„ ì¹´ë“œ -->
            <div class="card">
                <div style="font-weight: 600; font-size: 16px; margin-bottom: 15px;">
                    ëª©í‘œ: <span id="home-total-need-simple">5ì–µ 5ì²œë§Œì›</span>
                </div>

                <!-- ì§„í–‰ë¥  ë§‰ëŒ€ -->
                <div class="progress-bar" style="height: 16px; background: #f0f0f0; margin-bottom: 20px;">
                    <div id="home-main-progress" style="height: 100%; background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%); transition: width 0.5s; border-radius: 10px;"></div>
                </div>
                <div style="text-align: right; font-size: 14px; color: #666; margin-top: -15px; margin-bottom: 20px;" id="home-progress-percent">0%</div>

                <!-- í•­ëª©ë³„ ë¦¬ìŠ¤íŠ¸ -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                        <span style="color: #666; font-size: 14px;">âœ“ ì´ë¯¸ ë‚¸ ëˆ</span>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; font-size: 15px;" id="home-paid-simple">0ì›</div>
                            <div style="font-size: 12px; color: #22c55e;" id="home-paid-percent">(0%)</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                        <span style="color: #666; font-size: 14px;">ğŸ’° ë³´ìœ  í˜„ê¸ˆ</span>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; font-size: 15px;" id="home-cash-simple">0ì›</div>
                            <div style="font-size: 12px; color: #3b82f6;" id="home-cash-percent">(0%)</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 2px solid #cbd5e1;">
                        <span style="color: #666; font-size: 14px;">ğŸ¦ ëŒ€ì¶œ ê°€ëŠ¥</span>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; font-size: 15px;" id="home-loan-simple">0ì›</div>
                            <div style="font-size: 12px; color: #3b82f6;" id="home-loan-percent">(0%)</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0;">
                        <span style="font-weight: 600; font-size: 14px;" id="home-shortage-label">ğŸ”´ ë¶€ì¡±</span>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; font-size: 16px;" id="home-shortage-amount">0ì›</div>
                            <div style="font-size: 12px;" id="home-shortage-percent">(0%)</div>
                        </div>
                    </div>
                </div>

                <!-- ìƒì„¸ë³´ê¸° ë²„íŠ¼ -->
                <button class="btn btn-primary" onclick="showBudgetEdit()" style="margin-top: 15px;">âœï¸ ìê¸ˆê³„íš ìˆ˜ì •</button>
                
                <!-- ìƒì„¸ ë‚´ì—­ ì ‘ê¸°/í¼ì¹˜ê¸° -->
                <div style="margin-top: 15px; cursor: pointer; text-align: center; color: #667eea; font-weight: 500;" onclick="toggleDetail()">
                    <span id="detail-toggle">â–¼ ìƒì„¸ ë‚´ì—­ ë³´ê¸°</span>
                </div>
                
                <div id="detail-content" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 2px solid #f0f0f0;">
                    <!-- ì´ í•„ìš” ê¸ˆì•¡ ìƒì„¸ -->
                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #667eea; font-size: 14px;">ğŸ’° ì´ í•„ìš” ê¸ˆì•¡ êµ¬ì„±</div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">ğŸ“‹ ë¶„ì–‘ê°€</span>
                                <span style="font-weight: 500;" id="detail-base-price">0ì›</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">â• ì¤‘ë„ê¸ˆ ì´ì</span>
                                <span style="font-weight: 500;" id="detail-interest">0ì›</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">â• ì˜µì…˜</span>
                                <span style="font-weight: 500;" id="detail-options">0ì›</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px; border-top: 1px solid #e0e0e0; padding-top: 8px; margin-top: 5px;">
                                <span style="color: #666;">â• ì¸í…Œë¦¬ì–´/ê°€ì „/ê°€êµ¬</span>
                                <span style="font-weight: 500;" id="detail-extra">0ì›</span>
                            </div>
                        </div>
                    </div>

                    <!-- ì´ë¯¸ ë‚¸ ëˆ ìƒì„¸ -->
                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #667eea; font-size: 14px;">âœ… ì´ë¯¸ ë‚¸ ëˆ êµ¬ì„±</div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">ğŸ’³ ì¤‘ë„ê¸ˆ ë‚©ë¶€</span>
                                <span style="font-weight: 500;" id="detail-paid-deposit">0ì›</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">ğŸ’° ì™„ë£Œëœ ì§€ì¶œ</span>
                                <span style="font-weight: 500;" id="detail-paid-expenses">0ì›</span>
                            </div>
                        </div>
                    </div>

                    <!-- ëŒ€ì¶œ ì •ë³´ -->
                    <div>
                        <div style="font-weight: 600; margin-bottom: 10px; color: #667eea; font-size: 14px;">ğŸ¦ ëŒ€ì¶œ ì •ë³´</div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">ì§‘ ê°’</span>
                                <span style="font-weight: 500;" id="detail-home-price">0ì›</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">LTV ë¹„ìœ¨</span>
                                <span style="font-weight: 500;" id="detail-ltv">70%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">ì¤‘ë„ê¸ˆ ëŒ€ì¶œ ì´ììœ¨</span>
                                <span style="font-weight: 500;" id="detail-loan-rate">0%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px; border-top: 1px solid #e0e0e0; padding-top: 8px; margin-top: 5px;">
                                <span style="color: #666;">ì›” ëŒ€ì¶œ ì´ì</span>
                                <span style="font-weight: 500; color: #ef4444;" id="detail-monthly-interest">0ì›</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì…ì£¼ D-day -->
            <div class="card" style="padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-size: 14px; opacity: 0.9;">ì…ì£¼ê¹Œì§€</div>
                        <div style="font-size: 28px; font-weight: bold; margin-top: 5px;" id="home-dday">D-120</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="progress-bar" style="width: 100px; background: rgba(255,255,255,0.3);">
                            <div class="progress-fill" id="home-progress" style="background: white;"></div>
                        </div>
                        <div style="margin-top: 5px; font-size: 13px; opacity: 0.9;" id="home-progress-text">0%</div>
                    </div>
                </div>
            </div>

            <!-- ì €ì¶• í˜„í™© -->
            <div class="card">
                <div class="card-title">ğŸ† ì…ì£¼ ìê¸ˆ ëª¨ìœ¼ê¸°</div>
                <div class="amount-row">
                    <span class="amount-label">ëª©í‘œ</span>
                    <span class="amount-value" id="home-savings-goal">0ì›</span>
                </div>
                <div class="amount-row">
                    <span class="amount-label">ë‹¬ì„±</span>
                    <span class="amount-value" id="home-savings-current">0ì›</span>
                </div>
                <div class="progress-bar" style="background: #e0e0e0; margin-top: 10px;">
                    <div class="progress-fill" id="home-savings-progress" style="background: #667eea;"></div>
                </div>
                <div style="text-align: center; margin-top: 10px; color: #666; font-size: 14px;" id="home-savings-text">0%</div>
            </div>
        </div>

        <!-- ì§€ì¶œê´€ë¦¬ íƒ­ -->
        <div id="expenses" class="tab-content">
            <!-- ì¸í…Œë¦¬ì–´/ê°€ì „/ê°€êµ¬ ì˜ˆì‚° íŠ¸ë˜ì»¤ -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div style="font-weight: 600; font-size: 16px; margin-bottom: 15px;">ğŸ  ì¸í…Œë¦¬ì–´/ê°€ì „/ê°€êµ¬ ì˜ˆì‚°</div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span style="font-size: 14px; opacity: 0.9;">ì˜ˆì‚°</span>
                    <span style="font-size: 20px; font-weight: bold;" id="furniture-budget-total">3,000ë§Œì›</span>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <span style="font-size: 14px; opacity: 0.9;">ì‚¬ìš©</span>
                    <span style="font-size: 20px; font-weight: bold;" id="furniture-budget-used">0ë§Œì›</span>
                </div>
                
                <div class="progress-bar" style="background: rgba(255,255,255,0.3); height: 14px; margin-bottom: 10px;">
                    <div id="furniture-progress" style="height: 100%; background: white; border-radius: 10px; transition: width 0.3s;"></div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 14px; opacity: 0.9;">ë‚¨ì€ ì˜ˆì‚°</span>
                    <span style="font-size: 24px; font-weight: bold;" id="furniture-budget-remaining">3,000ë§Œì›</span>
                </div>
            </div>

            <!-- ë¹ ë¥¸ ì¶”ê°€ ë²„íŠ¼ -->
            <button class="btn btn-primary" onclick="showAddExpense()" style="margin-bottom: 15px;">+ í•­ëª© ì¶”ê°€</button>
            
            <!-- ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ ë‚´ì—­ -->
            <div id="expenses-list">
                <div style="color: #999; text-align: center; padding: 40px 0;">ë“±ë¡ëœ ì§€ì¶œì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
        </div>

        <!-- ìê¸ˆí˜„í™© íƒ­ -->
        <div id="savings" class="tab-content">
            <!-- ì´ ë³´ìœ  í˜„ê¸ˆ -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center;">
                <div style="font-size: 16px; opacity: 0.9;">ğŸ’° ì´ ë³´ìœ  í˜„ê¸ˆ</div>
                <div style="font-size: 36px; font-weight: bold; margin: 10px 0;" id="total-cash-display">0ë§Œì›</div>
            </div>

            <!-- ë³´ìœ  í˜„ê¸ˆ ë¦¬ìŠ¤íŠ¸ -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div class="card-title" style="margin: 0;">ğŸ’³ ë³´ìœ  í˜„ê¸ˆ ë‚´ì—­</div>
                    <button class="btn btn-primary" onclick="showAddCash()" style="width: auto; padding: 8px 15px; font-size: 14px;">+ ì¶”ê°€</button>
                </div>
                <div id="cash-list">
                    <div style="color: #999; text-align: center; padding: 20px 0;">ë“±ë¡ëœ í˜„ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤</div>
                </div>
            </div>

            <!-- ì €ì¶• ëª©í‘œ & ì €ê¸ˆí†µ -->
            <div class="card">
                <div class="card-title">ğŸ¯ ì…ì£¼ ìê¸ˆ ëª¨ìœ¼ê¸°</div>
                
                <!-- ëª©í‘œ ê¸ˆì•¡ ì„¤ì • -->
                <div class="input-group">
                    <label class="input-label">ëª©í‘œ ê¸ˆì•¡ (ë§Œì›)</label>
                    <input type="number" id="piggy-goal" placeholder="ì˜ˆ: 10000">
                </div>
                
                <!-- ì €ê¸ˆí†µ ì• ë‹ˆë©”ì´ì…˜ -->
                <div style="text-align: center; margin: 20px 0;">
                    <div style="font-size: 80px; margin-bottom: 10px;">ğŸ¦</div>
                    <div style="font-size: 24px; font-weight: bold; color: #667eea; margin-bottom: 5px;" id="piggy-saved">0ë§Œì›</div>
                    <div style="color: #666; font-size: 14px;">/ <span id="piggy-goal-display">0ë§Œì›</span></div>
                </div>
                
                <!-- ì§„í–‰ë°” -->
                <div class="progress-bar" style="background: #e0e0e0; height: 20px; margin-bottom: 10px;">
                    <div id="piggy-progress" style="height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); border-radius: 10px; transition: width 0.5s;"></div>
                </div>
                <div style="text-align: center; font-size: 18px; font-weight: bold; color: #667eea;" id="piggy-percent">0%</div>
            </div>

            <!-- ë‹¬ë ¥ í˜•ì‹ ì €ì¶• ê¸°ë¡ -->
            <div class="card">
                <div class="card-title">ğŸ“… ì´ë²ˆ ë‹¬ ì €ì¶• ê¸°ë¡</div>
                
                <!-- ì›” ì„ íƒ -->
                <div class="month-selector">
                    <button class="month-btn" onclick="changeCalendarMonth(-1)">â—€</button>
                    <div class="current-month" id="calendar-month">2025ë…„ 1ì›”</div>
                    <button class="month-btn" onclick="changeCalendarMonth(1)">â–¶</button>
                </div>
                
                <!-- ë¹ ë¥¸ ì…ë ¥ -->
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="date" id="saving-date" style="flex: 1;">
                        <input type="number" id="saving-amount" placeholder="ê¸ˆì•¡ (ë§Œì›)" style="flex: 1;">
                    </div>
                    <button class="btn btn-primary" onclick="addSavingRecord()">ğŸ’° ì €ì¶• ê¸°ë¡ ì¶”ê°€</button>
                </div>
                
                <!-- ë‹¬ë ¥ ê·¸ë¦¬ë“œ -->
                <div id="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 15px;">
                    <!-- ìš”ì¼ í—¤ë” -->
                </div>
                
                <!-- ì´ë²ˆ ë‹¬ ì´ ì €ì¶•ì•¡ -->
                <div style="margin-top: 20px; padding: 15px; background: #f8f9ff; border-radius: 10px; text-align: center;">
                    <div style="color: #666; font-size: 14px; margin-bottom: 5px;">ì´ë²ˆ ë‹¬ ì €ì¶•</div>
                    <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="month-total-savings">0ë§Œì›</div>
                </div>
            </div>
        </div>

        <!-- ì¼ì •ê´€ë¦¬ íƒ­ -->
        <div id="schedule" class="tab-content">
            <button class="btn btn-primary" onclick="showAddSchedule()" style="margin-bottom: 15px;">+ ì¼ì • ì¶”ê°€</button>
            
            <div class="timeline" id="schedule-list">
                <div style="color: #999; text-align: center; padding: 40px 0;">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
        </div>
    </div>

    <!-- í˜„ê¸ˆ ê³„ì¢Œ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="cash-modal" class="modal">
        <div class="modal-content">
            <div class="card-title">ğŸ’³ í˜„ê¸ˆ ê³„ì¢Œ ì¶”ê°€</div>
            <div class="input-group">
                <label class="input-label">ì´ë¦„ (ì˜ˆ: ìš°ë¦¬ì€í–‰, ì‹ í•œì¹´ë“œ, í˜„ê¸ˆ)</label>
                <input type="text" id="new-cash-name" placeholder="ìš°ë¦¬ì€í–‰">
            </div>
            <div class="input-group">
                <label class="input-label">ê¸ˆì•¡ (ë§Œì›)</label>
                <input type="number" id="new-cash-amount" placeholder="5000">
            </div>
            <div class="btn-row">
                <button class="btn btn-primary" onclick="addCashAccount()">ì¶”ê°€</button>
                <button class="btn btn-secondary" onclick="hideAddCash()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ìê¸ˆê³„íš ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="budget-modal" class="modal">
        <div class="modal-content">
            <div class="card-title">âœï¸ ìê¸ˆê³„íš ìˆ˜ì •</div>
            
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #667eea;">ğŸ’° ì´ í•„ìš” ê¸ˆì•¡</div>
                <div class="input-group">
                    <label class="input-label">ë¶„ì–‘ê°€ (ë§Œì›)</label>
                    <input type="number" id="budget-base-price" placeholder="ì˜ˆ: 52000">
                </div>
                <div class="input-group">
                    <label class="input-label">ì¤‘ë„ê¸ˆ ì´ì (ë§Œì›)</label>
                    <input type="number" id="budget-interest" placeholder="ì˜ˆ: 2000">
                </div>
                <div class="input-group">
                    <label class="input-label">ì˜µì…˜ ë¹„ìš© (ë§Œì›)</label>
                    <input type="number" id="budget-options" placeholder="ì˜ˆ: 1000">
                </div>
                <div class="input-group">
                    <label class="input-label">ì¸í…Œë¦¬ì–´/ê°€ì „/ê°€êµ¬ ì˜ˆì‚° (ë§Œì›)</label>
                    <input type="number" id="budget-extra" placeholder="ì˜ˆ: 3000">
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #667eea;">âœ… ì´ë¯¸ ë‚©ë¶€í•œ ê¸ˆì•¡</div>
                <div class="input-group">
                    <label class="input-label">ì¤‘ë„ê¸ˆ ë‚©ë¶€ì•¡ (ë§Œì›)</label>
                    <input type="number" id="budget-paid-deposit" placeholder="ì˜ˆ: 7000">
                </div>
                <div class="mini-card">
                    <div style="font-size: 13px; color: #666;">ğŸ’¡ ì™„ë£Œëœ ì§€ì¶œì€ ìë™ìœ¼ë¡œ í•©ì‚°ë©ë‹ˆë‹¤</div>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #667eea;">ğŸ’µ í˜„ì¬ ë³´ìœ  ìê¸ˆ</div>
                <div class="input-group">
                    <label class="input-label">ë³´ìœ  í˜„ê¸ˆ (ë§Œì›)</label>
                    <input type="number" id="budget-cash" placeholder="ì˜ˆ: 8000">
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #667eea;">ğŸ¦ ëŒ€ì¶œ ì •ë³´</div>
                <div class="input-group">
                    <label class="input-label">ì§‘ ê°’ (ë§Œì›)</label>
                    <input type="number" id="budget-home-price" placeholder="ì˜ˆ: 52000">
                </div>
                <div class="input-group">
                    <label class="input-label">ì¤‘ë„ê¸ˆ ëŒ€ì¶œì•¡ (ë§Œì›)</label>
                    <input type="number" id="budget-loan-deposit" placeholder="ì˜ˆ: 31200">
                </div>
                <div class="input-group">
                    <label class="input-label">ì¤‘ë„ê¸ˆ ëŒ€ì¶œ ì´ììœ¨ (%)</label>
                    <input type="number" step="0.01" id="budget-loan-rate" placeholder="ì˜ˆ: 4.5">
                </div>
                <div class="input-group">
                    <label class="input-label">LTV ë¹„ìœ¨ (%)</label>
                    <input type="number" id="budget-ltv" placeholder="ì˜ˆ: 70">
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #667eea;">ğŸ“… ì…ì£¼ ì˜ˆì •ì¼</div>
                <div class="input-group">
                    <input type="date" id="budget-move-date">
                </div>
            </div>

            <div class="mini-card" style="background: #f8f9ff; margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px;">ğŸ“Š ìë™ ê³„ì‚°</div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span style="font-size: 13px; color: #666;">LTV ê¸°ì¤€ ëŒ€ì¶œ ê°€ëŠ¥ì•¡</span>
                    <span style="font-weight: bold;" id="budget-ltv-amount">0ë§Œì›</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="font-size: 13px; color: #666;">ì›” ëŒ€ì¶œ ì´ì</span>
                    <span style="font-weight: bold;" id="budget-monthly-interest">0ë§Œì›</span>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-primary" onclick="saveBudget()">ì €ì¥</button>
                <button class="btn btn-secondary" onclick="hideBudgetEdit()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì¼ì • ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="schedule-modal" class="modal">
        <div class="modal-content">
            <div class="card-title">ğŸ“… ì¼ì • ì¶”ê°€</div>
            <div class="input-group">
                <label class="input-label">ì¼ì • ì œëª©</label>
                <input type="text" id="new-schedule-title" placeholder="ì˜ˆ: ì¤‘ë„ê¸ˆ 3ì°¨ ë‚©ë¶€">
            </div>
            <div class="input-group">
                <label class="input-label">ë‚ ì§œ</label>
                <input type="date" id="new-schedule-date">
            </div>
            <div class="input-group">
                <label class="input-label">ê¸ˆì•¡ (ë§Œì›, ì„ íƒì‚¬í•­)</label>
                <input type="number" id="new-schedule-amount" placeholder="ì˜ˆ: 1500">
            </div>
            <div class="input-group">
                <label class="input-label">ë©”ëª¨</label>
                <textarea id="new-schedule-memo" rows="2" placeholder="ë©”ëª¨ì‚¬í•­"></textarea>
            </div>
            <div class="btn-row">
                <button class="btn btn-primary" onclick="addSchedule()">ì¶”ê°€</button>
                <button class="btn btn-secondary" onclick="hideAddSchedule()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì§€ì¶œ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="expense-modal" class="modal">
        <div class="modal-content">
            <div class="card-title">ğŸ’³ ì§€ì¶œ í•­ëª© ì¶”ê°€</div>
            <div class="input-group">
                <label class="input-label">ì¹´í…Œê³ ë¦¬</label>
                <select id="new-expense-category">
                    <option>ì¸í…Œë¦¬ì–´</option>
                    <option>ê°€ì „</option>
                    <option>ê°€êµ¬</option>
                </select>
            </div>
            <div class="input-group">
                <label class="input-label">í•­ëª©ëª…</label>
                <input type="text" id="new-expense-item" placeholder="ì˜ˆ: ì‹œìŠ¤í…œ ì—ì–´ì»¨">
            </div>
            <div class="input-group">
                <label class="input-label">ì˜ˆì‚° (ë§Œì›)</label>
                <input type="number" id="new-expense-budget" placeholder="ì˜ˆ: 500">
            </div>
            <div class="input-group">
                <label class="input-label">ì‹¤ì œ ì§€ì¶œ (ë§Œì›)</label>
                <input type="number" id="new-expense-actual" placeholder="ì˜ˆ: 480">
            </div>
            <div class="input-group">
                <label class="input-label">ìƒíƒœ</label>
                <select id="new-expense-status">
                    <option>ì˜ˆì •</option>
                    <option>ì§„í–‰ì¤‘</option>
                    <option>ì™„ë£Œ</option>
                    <option>ë³´ë¥˜</option>
                </select>
            </div>
            <div class="input-group">
                <label class="input-label">ì˜ìˆ˜ì¦ ì‚¬ì§„</label>
                <input type="file" id="new-expense-receipt" accept="image/*">
            </div>
            <div class="input-group">
                <label class="input-label">ë©”ëª¨</label>
                <textarea id="new-expense-memo" rows="2" placeholder="ì—…ì²´ëª…, ì—°ë½ì²˜ ë“±"></textarea>
            </div>
            <div class="btn-row">
                <button class="btn btn-primary" onclick="addExpenseItem()">ì¶”ê°€</button>
                <button class="btn btn-secondary" onclick="hideAddExpense()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        var data = {
            budget: {
                basePrice: 0,
                interest: 0,
                options: 0,
                extra: 0,
                paidDeposit: 0,
                cash: 0,
                homePrice: 0,
                loanDeposit: 0,
                loanRate: 0,
                ltv: 70
            },
            schedules: [],
            expenses: [],
            cashAccounts: [],
            savingGoal: 0,
            savingRecords: {},
            moveInDate: ''
        };

        var currentMonth = new Date();
        var calendarMonth = new Date();

        function toggleDetail() {
            var content = document.getElementById('detail-content');
            var toggle = document.getElementById('detail-toggle');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = 'â–² ìƒì„¸ ë‚´ì—­ ë‹«ê¸°';
            } else {
                content.style.display = 'none';
                toggle.textContent = 'â–¼ ìƒì„¸ ë‚´ì—­ ë³´ê¸°';
            }
        }

        function showAddCash() {
            document.getElementById('cash-modal').classList.add('active');
        }

        function hideAddCash() {
            document.getElementById('cash-modal').classList.remove('active');
            document.getElementById('new-cash-name').value = '';
            document.getElementById('new-cash-amount').value = '';
        }

        function addCashAccount() {
            var name = document.getElementById('new-cash-name').value;
            var amount = Number(document.getElementById('new-cash-amount').value);
            
            if (!name || !amount) {
                alert('ì´ë¦„ê³¼ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            data.cashAccounts.push({
                id: Date.now(),
                name: name,
                amount: amount
            });
            
            saveData();
            hideAddCash();
        }

        function deleteCashAccount(id) {
            if (confirm('ì´ ê³„ì¢Œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                data.cashAccounts = data.cashAccounts.filter(function(acc) {
                    return acc.id !== id;
                });
                saveData();
            }
        }

        function editCashAccount(id) {
            var account = data.cashAccounts.find(function(acc) {
                return acc.id === id;
            });
            
            if (!account) return;
            
            var newAmount = prompt('ìƒˆ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (ë§Œì›)', account.amount);
            if (newAmount !== null && newAmount !== '') {
                account.amount = Number(newAmount);
                saveData();
            }
        }

        function updateCashList() {
            var html = '';
            var total = 0;
            
            for (var i = 0; i < data.cashAccounts.length; i++) {
                var acc = data.cashAccounts[i];
                total += acc.amount;
                
                html += '<div class="item-card" style="display: flex; justify-content: space-between; align-items: center;">';
                html += '<div>';
                html += '<div style="font-weight: bold; font-size: 15px;">' + acc.name + '</div>';
                html += '<div style="color: #667eea; font-weight: bold; font-size: 16px; margin-top: 3px;">' + formatWon(acc.amount) + '</div>';
                html += '</div>';
                html += '<div style="display: flex; gap: 5px;">';
                html += '<button class="btn-delete" style="background: #667eea; width: auto; padding: 6px 12px;" onclick="editCashAccount(' + acc.id + ')">ìˆ˜ì •</button>';
                html += '<button class="btn-delete" onclick="deleteCashAccount(' + acc.id + ')">ì‚­ì œ</button>';
                html += '</div>';
                html += '</div>';
            }
            
            document.getElementById('cash-list').innerHTML = html || '<div style="color: #999; text-align: center; padding: 20px 0;">ë“±ë¡ëœ í˜„ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤</div>';
            document.getElementById('total-cash-display').textContent = formatWon(total);
            
            // data.budget.cash ì—…ë°ì´íŠ¸
            data.budget.cash = total;
        }

        function showBudgetEdit() {
            document.getElementById('budget-modal').classList.add('active');
            updateBudgetModal();
        }

        function hideBudgetEdit() {
            document.getElementById('budget-modal').classList.remove('active');
        }

        function saveBudget() {
            var moveDate = document.getElementById('budget-move-date').value;
            if (moveDate) {
                data.moveInDate = moveDate;
            }
            saveData();
            hideBudgetEdit();
        }

        function updateBudgetModal() {
            document.getElementById('budget-base-price').value = data.budget.basePrice || '';
            document.getElementById('budget-interest').value = data.budget.interest || '';
            document.getElementById('budget-options').value = data.budget.options || '';
            document.getElementById('budget-extra').value = data.budget.extra || '';
            document.getElementById('budget-paid-deposit').value = data.budget.paidDeposit || '';
            document.getElementById('budget-cash').value = data.budget.cash || '';
            document.getElementById('budget-home-price').value = data.budget.homePrice || '';
            document.getElementById('budget-loan-deposit').value = data.budget.loanDeposit || '';
            document.getElementById('budget-loan-rate').value = data.budget.loanRate || '';
            document.getElementById('budget-ltv').value = data.budget.ltv || 70;
            document.getElementById('budget-move-date').value = data.moveInDate || '';
            
            updateBudgetCalculations();
        }

        function updateBudgetCalculations() {
            var ltvAmount = 0;
            if (data.budget.homePrice > 0 && data.budget.ltv > 0) {
                ltvAmount = Math.floor(data.budget.homePrice * data.budget.ltv / 100);
            }
            document.getElementById('budget-ltv-amount').textContent = formatNumber(ltvAmount) + 'ë§Œì›';
            
            var monthlyInterest = 0;
            if (data.budget.loanDeposit > 0 && data.budget.loanRate > 0) {
                monthlyInterest = Math.round(data.budget.loanDeposit * (data.budget.loanRate / 100) / 12);
            }
            document.getElementById('budget-monthly-interest').textContent = formatNumber(monthlyInterest) + 'ë§Œì›';
        }

        function loadData() {
            var saved = localStorage.getItem('newHomeBudget');
            if (saved) {
                data = JSON.parse(saved);
                // ê¸°ì¡´ ë°ì´í„°ì— ìƒˆ í•„ë“œ ì¶”ê°€
                if (!data.cashAccounts) data.cashAccounts = [];
                if (!data.savingRecords) data.savingRecords = {};
                if (!data.savingGoal) data.savingGoal = 0;
            }
            currentMonth = new Date();
            calendarMonth = new Date();
            updateAllUI();
        }

        function saveData() {
            localStorage.setItem('newHomeBudget', JSON.stringify(data));
            updateAllUI();
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(num);
        }

        function formatWon(num) {
            if (num >= 10000) {
                var eok = Math.floor(num / 10000);
                var man = num % 10000;
                if (man === 0) {
                    return eok + 'ì–µì›';
                }
                return eok + 'ì–µ ' + formatNumber(man) + 'ë§Œì›';
            }
            return formatNumber(num) + 'ë§Œì›';
        }

        function showTab(tabName) {
            var tabs = document.querySelectorAll('.tab');
            var contents = document.querySelectorAll('.tab-content');
            
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            for (var i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            
            window.event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function updateAllUI() {
            updateHomeTab();
            updateScheduleList();
            updateExpensesList();
            updateSavingsTab();
        }

        function updateHomeTab() {
            var totalNeed = data.budget.basePrice + data.budget.interest + data.budget.options + data.budget.extra;
            
            var completedExpenses = 0;
            for (var i = 0; i < data.expenses.length; i++) {
                if (data.expenses[i].status === 'ì™„ë£Œ') {
                    completedExpenses += Number(data.expenses[i].actual);
                }
            }
            var totalPaid = data.budget.paidDeposit + completedExpenses;
            
            var loanAvailable = 0;
            if (data.budget.homePrice > 0 && data.budget.ltv > 0) {
                loanAvailable = Math.floor(data.budget.homePrice * data.budget.ltv / 100);
            }
            var totalAvailable = data.budget.cash + loanAvailable;
            
            var finalAmount = totalNeed - totalPaid - totalAvailable;
            
            // ìµœì¢… ìƒíƒœ ì¹´ë“œ
            var statusCard = document.getElementById('home-final-status');
            var statusAmount = document.getElementById('home-final-amount');
            var statusText = document.getElementById('home-final-text');
            
            if (finalAmount > 0) {
                statusCard.className = 'card status-card warning';
                statusAmount.textContent = formatWon(Math.abs(finalAmount));
                statusText.innerHTML = 'ğŸ”´ ë¶€ì¡± - ë” ëª¨ì•„ì•¼ í•´ìš”!';
            } else {
                statusCard.className = 'card status-card success';
                statusAmount.textContent = formatWon(Math.abs(finalAmount));
                statusText.innerHTML = 'ğŸŸ¢ ì—¬ìœ  - ì—¬ìœ ìˆì–´ìš”! ğŸ‘';
            }
            
            // í†µí•© ë§‰ëŒ€ ê·¸ë˜í”„
            document.getElementById('home-total-need-simple').textContent = formatWon(totalNeed);
            
            // ì§„í–‰ë¥  ê³„ì‚° (ì´ë¯¸ ë‚¸ ëˆ + í™•ë³´ ê°€ëŠ¥í•œ ëˆ)
            var secured = totalPaid + totalAvailable;
            var progressPercent = totalNeed > 0 ? Math.min((secured / totalNeed) * 100, 100) : 0;
            document.getElementById('home-main-progress').style.width = progressPercent + '%';
            document.getElementById('home-progress-percent').textContent = Math.round(progressPercent) + '%';
            
            // ì´ë¯¸ ë‚¸ ëˆ
            var paidPercent = totalNeed > 0 ? (totalPaid / totalNeed) * 100 : 0;
            document.getElementById('home-paid-simple').textContent = formatWon(totalPaid);
            document.getElementById('home-paid-percent').textContent = '(' + Math.round(paidPercent) + '%)';
            
            // ë³´ìœ  í˜„ê¸ˆ
            var cashPercent = totalNeed > 0 ? (data.budget.cash / totalNeed) * 100 : 0;
            document.getElementById('home-cash-simple').textContent = formatWon(data.budget.cash);
            document.getElementById('home-cash-percent').textContent = '(' + Math.round(cashPercent) + '%)';
            
            // ëŒ€ì¶œ ê°€ëŠ¥
            var loanPercent = totalNeed > 0 ? (loanAvailable / totalNeed) * 100 : 0;
            document.getElementById('home-loan-simple').textContent = formatWon(loanAvailable);
            document.getElementById('home-loan-percent').textContent = '(' + Math.round(loanPercent) + '%)';
            
            // ë¶€ì¡±/ì—¬ìœ 
            var shortagePercent = totalNeed > 0 ? (Math.abs(finalAmount) / totalNeed) * 100 : 0;
            if (finalAmount > 0) {
                document.getElementById('home-shortage-label').textContent = 'ğŸ”´ ë¶€ì¡±';
                document.getElementById('home-shortage-amount').textContent = formatWon(Math.abs(finalAmount));
                document.getElementById('home-shortage-amount').style.color = '#ef4444';
                document.getElementById('home-shortage-percent').textContent = '(' + Math.round(shortagePercent) + '%)';
                document.getElementById('home-shortage-percent').style.color = '#ef4444';
            } else {
                document.getElementById('home-shortage-label').textContent = 'ğŸŸ¢ ì—¬ìœ ';
                document.getElementById('home-shortage-amount').textContent = formatWon(Math.abs(finalAmount));
                document.getElementById('home-shortage-amount').style.color = '#22c55e';
                document.getElementById('home-shortage-percent').textContent = '(' + Math.round(shortagePercent) + '%)';
                document.getElementById('home-shortage-percent').style.color = '#22c55e';
            }
            
            // D-day
            if (data.moveInDate) {
                var today = new Date();
                var moveIn = new Date(data.moveInDate);
                var diff = Math.ceil((moveIn - today) / (1000 * 60 * 60 * 24));
                document.getElementById('home-dday').textContent = 'D-' + diff;
                
                var totalDays = 365;
                var passedDays = totalDays - diff;
                var progress = Math.max(0, Math.min(100, (passedDays / totalDays) * 100));
                document.getElementById('home-progress').style.width = progress + '%';
                document.getElementById('home-progress-text').textContent = Math.round(progress) + '%';
            }
            
            // ì €ì¶•
            var totalSaved = 0;
            for (var date in data.savingRecords) {
                totalSaved += data.savingRecords[date];
            }
            var goal = data.savingGoal || 0;
            var savingsPercent = goal > 0 ? Math.min((totalSaved / goal) * 100, 100) : 0;
            
            document.getElementById('home-savings-goal').textContent = formatWon(goal);
            document.getElementById('home-savings-current').textContent = formatWon(totalSaved);
            document.getElementById('home-savings-progress').style.width = savingsPercent + '%';
            document.getElementById('home-savings-text').textContent = Math.round(savingsPercent) + '%';
            
            // ìƒì„¸ ë‚´ì—­ ì—…ë°ì´íŠ¸
            document.getElementById('detail-base-price').textContent = formatWon(data.budget.basePrice);
            document.getElementById('detail-interest').textContent = formatWon(data.budget.interest);
            document.getElementById('detail-options').textContent = formatWon(data.budget.options);
            document.getElementById('detail-extra').textContent = formatWon(data.budget.extra);
            document.getElementById('detail-paid-deposit').textContent = formatWon(data.budget.paidDeposit);
            document.getElementById('detail-paid-expenses').textContent = formatWon(completedExpenses);
            document.getElementById('detail-home-price').textContent = formatWon(data.budget.homePrice);
            document.getElementById('detail-ltv').textContent = data.budget.ltv + '%';
            document.getElementById('detail-loan-rate').textContent = data.budget.loanRate + '%';
            
            var monthlyInterest = 0;
            if (data.budget.loanDeposit > 0 && data.budget.loanRate > 0) {
                monthlyInterest = Math.round(data.budget.loanDeposit * (data.budget.loanRate / 100) / 12);
            }
            document.getElementById('detail-monthly-interest').textContent = formatWon(monthlyInterest);
        }

        function updateScheduleList() {
            var sorted = data.schedules.slice().sort(function(a, b) {
                return new Date(a.date) - new Date(b.date);
            });
            
            var html = '';
            for (var i = 0; i < sorted.length; i++) {
                var sch = sorted[i];
                var isDone = sch.status === 'ì™„ë£Œ';
                
                html += '<div class="timeline-item' + (isDone ? ' done' : '') + '">';
                if (i < sorted.length - 1) {
                    html += '<div class="timeline-line"></div>';
                }
                html += '<div class="item-card">';
                html += '<div class="item-header">';
                html += '<div>';
                html += '<div class="item-title">' + sch.title + '</div>';
                html += '<div style="font-size: 13px; color: #666; margin-top: 3px;">ğŸ“… ' + sch.date + '</div>';
                if (sch.amount > 0) {
                    html += '<div style="font-size: 14px; font-weight: bold; color: #667eea; margin-top: 5px;">ğŸ’° ' + formatWon(sch.amount) + '</div>';
                }
                html += '</div>';
                html += '<button class="btn-delete" onclick="deleteSchedule(' + sch.id + ')">ì‚­ì œ</button>';
                html += '</div>';
                if (sch.memo) {
                    html += '<div style="margin-top: 10px; font-size: 13px; color: #666; padding: 8px; background: white; border-radius: 5px;">' + sch.memo + '</div>';
                }
                html += '<div style="margin-top: 10px;">';
                html += '<label style="font-size: 13px; color: #666; margin-right: 10px;">';
                html += '<input type="checkbox" ' + (isDone ? 'checked' : '') + ' onchange="toggleScheduleStatus(' + sch.id + ')"> ì™„ë£Œ';
                html += '</label>';
                html += '</div>';
                html += '</div></div>';
            }
            
            document.getElementById('schedule-list').innerHTML = html || '<div style="color: #999; text-align: center; padding: 40px 0;">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        }

        function updateExpensesList() {
            var furnitureCategories = ['ì¸í…Œë¦¬ì–´', 'ê°€ì „', 'ê°€êµ¬'];
            var html = '';
            var totalUsed = 0;
            
            for (var c = 0; c < furnitureCategories.length; c++) {
                var cat = furnitureCategories[c];
                var catExpenses = [];
                
                for (var i = 0; i < data.expenses.length; i++) {
                    if (data.expenses[i].category === cat) {
                        catExpenses.push(data.expenses[i]);
                        totalUsed += Number(data.expenses[i].actual) || 0;
                    }
                }
                
                if (catExpenses.length > 0) {
                    html += '<div class="category-header">' + cat + '</div>';
                    
                    for (var i = 0; i < catExpenses.length; i++) {
                        var exp = catExpenses[i];
                        html += '<div class="item-card">';
                        html += '<div class="item-header">';
                        html += '<div>';
                        html += '<div class="item-title">' + exp.item + '</div>';
                        html += '<div class="item-status' + (exp.status === 'ì™„ë£Œ' ? ' status-done' : '') + '">' + exp.status + '</div>';
                        html += '</div>';
                        html += '<button class="btn-delete" onclick="deleteExpense(' + exp.id + ')">ì‚­ì œ</button>';
                        html += '</div>';
                        html += '<div style="margin-top: 10px;">';
                        html += '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">';
                        html += '<span style="color: #666; font-size: 14px;">ì˜ˆì‚°</span>';
                        html += '<span style="font-weight: bold;">' + formatWon(exp.budget) + '</span>';
                        html += '</div>';
                        html += '<div style="display: flex; justify-content: space-between;">';
                        html += '<span style="color: #666; font-size: 14px;">ì‹¤ì œ</span>';
                        html += '<span style="font-weight: bold; color: #ff4757;">' + formatWon(exp.actual) + '</span>';
                        html += '</div>';
                        html += '</div>';
                        if (exp.memo) {
                            html += '<div style="margin-top: 10px; font-size: 13px; color: #666; padding: 8px; background: white; border-radius: 5px;">' + exp.memo + '</div>';
                        }
                        if (exp.receipt) {
                            html += '<img src="' + exp.receipt + '" class="receipt-img">';
                        }
                        html += '</div>';
                    }
                }
            }
            
            document.getElementById('expenses-list').innerHTML = html || '<div style="color: #999; text-align: center; padding: 40px 0;">ë“±ë¡ëœ ì§€ì¶œì´ ì—†ìŠµë‹ˆë‹¤</div>';
            
            // ì˜ˆì‚° íŠ¸ë˜ì»¤ ì—…ë°ì´íŠ¸
            var furnitureBudget = data.budget.extra || 0;
            var remaining = furnitureBudget - totalUsed;
            var usedPercent = furnitureBudget > 0 ? (totalUsed / furnitureBudget) * 100 : 0;
            
            document.getElementById('furniture-budget-total').textContent = formatWon(furnitureBudget);
            document.getElementById('furniture-budget-used').textContent = formatWon(totalUsed);
            document.getElementById('furniture-budget-remaining').textContent = formatWon(remaining);
            document.getElementById('furniture-progress').style.width = Math.min(usedPercent, 100) + '%';
        }

        function updateSavingsTab() {
            // í˜„ê¸ˆ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            updateCashList();
            
            // ì €ê¸ˆí†µ ì—…ë°ì´íŠ¸
            var goal = data.savingGoal || 0;
            var totalSaved = 0;
            
            for (var date in data.savingRecords) {
                totalSaved += data.savingRecords[date];
            }
            
            document.getElementById('piggy-goal').value = goal || '';
            document.getElementById('piggy-goal-display').textContent = formatWon(goal);
            document.getElementById('piggy-saved').textContent = formatWon(totalSaved);
            
            var percent = goal > 0 ? Math.min((totalSaved / goal) * 100, 100) : 0;
            document.getElementById('piggy-progress').style.width = percent + '%';
            document.getElementById('piggy-percent').textContent = Math.round(percent) + '%';
            
            // ë‹¬ë ¥ ë Œë”ë§
            renderCalendar();
        }

        function showAddSchedule() {
            document.getElementById('schedule-modal').classList.add('active');
        }

        function hideAddSchedule() {
            document.getElementById('schedule-modal').classList.remove('active');
            document.getElementById('new-schedule-title').value = '';
            document.getElementById('new-schedule-date').value = '';
            document.getElementById('new-schedule-amount').value = '';
            document.getElementById('new-schedule-memo').value = '';
        }

        function addSchedule() {
            var title = document.getElementById('new-schedule-title').value;
            var date = document.getElementById('new-schedule-date').value;
            
            if (!title || !date) {
                alert('ì œëª©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            data.schedules.push({
                id: Date.now(),
                title: title,
                date: date,
                amount: Number(document.getElementById('new-schedule-amount').value) || 0,
                memo: document.getElementById('new-schedule-memo').value,
                status: 'ì˜ˆì •'
            });
            
            saveData();
            hideAddSchedule();
        }

        function deleteSchedule(id) {
            if (confirm('ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                var newSchedules = [];
                for (var i = 0; i < data.schedules.length; i++) {
                    if (data.schedules[i].id !== id) {
                        newSchedules.push(data.schedules[i]);
                    }
                }
                data.schedules = newSchedules;
                saveData();
            }
        }

        function toggleScheduleStatus(id) {
            for (var i = 0; i < data.schedules.length; i++) {
                if (data.schedules[i].id === id) {
                    data.schedules[i].status = data.schedules[i].status === 'ì™„ë£Œ' ? 'ì˜ˆì •' : 'ì™„ë£Œ';
                    break;
                }
            }
            saveData();
        }

        function showAddExpense() {
            document.getElementById('expense-modal').classList.add('active');
        }

        function hideAddExpense() {
            document.getElementById('expense-modal').classList.remove('active');
            document.getElementById('new-expense-item').value = '';
            document.getElementById('new-expense-budget').value = '';
            document.getElementById('new-expense-actual').value = '';
            document.getElementById('new-expense-memo').value = '';
            document.getElementById('new-expense-receipt').value = '';
        }

        function addExpenseItem() {
            var item = document.getElementById('new-expense-item').value;
            if (!item) {
                alert('í•­ëª©ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            var receiptFile = document.getElementById('new-expense-receipt').files[0];
            var receiptData = null;
            
            if (receiptFile) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    data.expenses.push({
                        id: Date.now(),
                        category: document.getElementById('new-expense-category').value,
                        item: item,
                        budget: Number(document.getElementById('new-expense-budget').value) || 0,
                        actual: Number(document.getElementById('new-expense-actual').value) || 0,
                        status: document.getElementById('new-expense-status').value,
                        memo: document.getElementById('new-expense-memo').value,
                        receipt: e.target.result
                    });
                    saveData();
                    hideAddExpense();
                };
                reader.readAsDataURL(receiptFile);
            } else {
                data.expenses.push({
                    id: Date.now(),
                    category: document.getElementById('new-expense-category').value,
                    item: item,
                    budget: Number(document.getElementById('new-expense-budget').value) || 0,
                    actual: Number(document.getElementById('new-expense-actual').value) || 0,
                    status: document.getElementById('new-expense-status').value,
                    memo: document.getElementById('new-expense-memo').value,
                    receipt: null
                });
                saveData();
                hideAddExpense();
            }
        }

        function deleteExpense(id) {
            if (confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                var newExpenses = [];
                for (var i = 0; i < data.expenses.length; i++) {
                    if (data.expenses[i].id !== id) {
                        newExpenses.push(data.expenses[i]);
                    }
                }
                data.expenses = newExpenses;
                saveData();
            }
        }

        function changeCalendarMonth(delta) {
            calendarMonth.setMonth(calendarMonth.getMonth() + delta);
            updateSavingsTab();
        }

        function addSavingRecord() {
            var date = document.getElementById('saving-date').value;
            var amount = Number(document.getElementById('saving-amount').value);
            
            if (!date || !amount) {
                alert('ë‚ ì§œì™€ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            if (!data.savingRecords[date]) {
                data.savingRecords[date] = 0;
            }
            data.savingRecords[date] += amount;
            
            document.getElementById('saving-date').value = '';
            document.getElementById('saving-amount').value = '';
            saveData();
        }

        function renderCalendar() {
            var year = calendarMonth.getFullYear();
            var month = calendarMonth.getMonth();
            
            document.getElementById('calendar-month').textContent = year + 'ë…„ ' + (month + 1) + 'ì›”';
            
            var firstDay = new Date(year, month, 1).getDay();
            var daysInMonth = new Date(year, month + 1, 0).getDate();
            
            var html = '';
            var weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            
            for (var i = 0; i < 7; i++) {
                html += '<div style="text-align: center; font-weight: bold; padding: 8px; color: #666; font-size: 13px;">' + weekdays[i] + '</div>';
            }
            
            for (var i = 0; i < firstDay; i++) {
                html += '<div></div>';
            }
            
            var monthTotal = 0;
            
            for (var day = 1; day <= daysInMonth; day++) {
                var monthStr = month + 1 < 10 ? '0' + (month + 1) : String(month + 1);
                var dayStr = day < 10 ? '0' + day : String(day);
                var dateStr = year + '-' + monthStr + '-' + dayStr;
                var amount = data.savingRecords[dateStr] || 0;
                
                if (amount > 0) {
                    monthTotal += amount;
                }
                
                var isToday = new Date().toDateString() === new Date(year, month, day).toDateString();
                var bgColor = isToday ? '#f8f9ff' : 'white';
                var border = isToday ? '2px solid #667eea' : '1px solid #e0e0e0';
                
                html += '<div style="border: ' + border + '; border-radius: 8px; padding: 8px 4px; text-align: center; min-height: 60px; background: ' + bgColor + ';">';
                html += '<div style="font-size: 13px; font-weight: ' + (isToday ? 'bold' : 'normal') + '; color: ' + (isToday ? '#667eea' : '#333') + ';">' + day + '</div>';
                if (amount > 0) {
                    html += '<div style="font-size: 11px; color: #667eea; font-weight: bold; margin-top: 3px;">ğŸ’°</div>';
                    html += '<div style="font-size: 10px; color: #667eea; font-weight: bold;">' + formatNumber(amount) + '</div>';
                }
                html += '</div>';
            }
            
            document.getElementById('calendar-grid').innerHTML = html;
            document.getElementById('month-total-savings').textContent = formatWon(monthTotal);
        }

        var budgetFields = ['base-price', 'interest', 'options', 'extra', 'paid-deposit', 'cash', 'home-price', 'loan-deposit', 'loan-rate', 'ltv'];
        for (var i = 0; i < budgetFields.length; i++) {
            var field = budgetFields[i];
            var elem = document.getElementById('budget-' + field);
            elem.setAttribute('data-field', field);
            elem.addEventListener('input', function() {
                var fieldName = this.getAttribute('data-field').replace(/-([a-z])/g, function(g) { 
                    return g[1].toUpperCase(); 
                });
                data.budget[fieldName] = Number(this.value) || 0;
                saveData();
            });
        }

        document.getElementById('piggy-goal').addEventListener('input', function() {
            data.savingGoal = Number(this.value) || 0;
            saveData();
        });

        loadData();
    </script>
</body>
</html>
