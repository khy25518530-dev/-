<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ  ìš°ë¦¬ì§‘ ì…ì£¼ ì¤€ë¹„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
            background: #f5f7fa;
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        /* ìƒë‹¨ í—¤ë” */
        .header {
            background: white;
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .header-title {
            font-size: 22px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }
        
        .header-subtitle {
            font-size: 13px;
            color: #64748b;
        }
        
        .firebase-status {
            font-size: 11px;
            color: #10b981;
            margin-top: 4px;
        }
        
        /* í•˜ë‹¨ íƒ­ë°” */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 500px;
            background: white;
            border-top: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-around;
            padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
            z-index: 100;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 6px;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav-icon {
            font-size: 22px;
            filter: grayscale(1);
            opacity: 0.4;
            transition: all 0.2s;
        }
        
        .nav-label {
            font-size: 11px;
            color: #94a3b8;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .nav-item.active .nav-icon {
            filter: grayscale(0);
            opacity: 1;
            transform: scale(1.1);
        }
        
        .nav-item.active .nav-label {
            color: #10b981;
            font-weight: 600;
        }
        
        /* ì»¨í…ì¸  ì˜ì—­ */
        .content {
            padding: 16px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ì¹´ë“œ */
        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }
        
        .card-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1e293b;
        }
        
        /* ë¯¼íŠ¸ ê·¸ë¼ë°ì´ì…˜ ì¹´ë“œ */
        .mint-card {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            text-align: center;
            padding: 28px 24px;
            border-radius: 20px;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .big-amount {
            font-size: 36px;
            font-weight: 700;
            margin: 12px 0;
            letter-spacing: -0.5px;
        }
        
        /* í”Œë¡œíŒ… ë²„íŠ¼ */
        .floating-btn {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
            cursor: pointer;
            z-index: 99;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .floating-btn:active {
            transform: scale(0.95);
        }
        
        /* ìƒíƒœ ì¹´ë“œ */
        .status-card {
            text-align: center;
            padding: 24px;
        }
        
        .status-card.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .status-card.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .status-amount {
            font-size: 38px;
            font-weight: 700;
            margin: 12px 0;
        }
        
        /* ì§„í–‰ë°” */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: white;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        /* ì…ë ¥ */
        .input-group {
            margin-bottom: 14px;
        }
        
        .input-label {
            font-size: 13px;
            color: #64748b;
            margin-bottom: 6px;
            display: block;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 14px;
            border: 1.5px solid #e2e8f0;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.2s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        /* ë²„íŠ¼ */
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #10b981;
            color: white;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
            background: #059669;
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
        }
        
        .btn-delete {
            background: #ef4444;
            color: white;
            padding: 8px 14px;
            font-size: 13px;
            width: auto;
            border-radius: 8px;
        }
        
        /* ì•„ì´í…œ ì¹´ë“œ */
        .item-card {
            background: #f8fafc;
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 10px;
            border: 1px solid #f1f5f9;
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }
        
        .item-title {
            font-weight: 600;
            font-size: 15px;
            color: #1e293b;
        }
        
        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 24px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* ê¸ˆì•¡ í‘œì‹œ */
        .amount-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .amount-label {
            color: #64748b;
            font-size: 14px;
        }
        
        .amount-value {
            font-weight: 600;
            font-size: 15px;
            color: #1e293b;
        }
        
        .total-row {
            background: #f0fdf4;
            padding: 14px;
            border-radius: 12px;
            margin-top: 10px;
            border: 1px solid #d1fae5;
        }
        
        .total-amount {
            font-size: 22px;
            font-weight: 700;
            color: #059669;
        }
        
        /* ì›” ì„ íƒ */
        .month-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding: 14px;
            background: white;
            border-radius: 14px;
        }
        
        .month-btn {
            background: #f1f5f9;
            color: #475569;
            border: none;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .current-month {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ í—¤ë” -->
    <div class="header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div class="header-title">ğŸ  ìš°ë¦¬ì§‘ ì…ì£¼ ì¤€ë¹„</div>
                <div class="header-subtitle">ì²´ê³„ì ì¸ ìê¸ˆ ê´€ë¦¬</div>
                <div class="firebase-status" id="firebase-status">ğŸ”„ ì—°ê²° ì¤‘...</div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 11px; color: #64748b; margin-bottom: 2px;">ì…ì£¼ê¹Œì§€</div>
                <div id="header-dday" style="font-size: 24px; font-weight: 700; color: #10b981;">D-day</div>
                <button onclick="editMoveInDate()" style="background: #f0fdf4; border: 1px solid #d1fae5; color: #059669; padding: 4px 10px; border-radius: 6px; font-size: 11px; cursor: pointer; font-weight: 600; margin-top: 4px;">âœï¸ ìˆ˜ì •</button>
            </div>
        </div>
    </div>

    <!-- ì»¨í…ì¸  ì˜ì—­ -->
    <div class="content">
        <!-- í™ˆ íƒ­ -->
        <div id="home" class="tab-content active">
            <!-- ìµœì¢… ìƒíƒœ ì¹´ë“œ -->
            <div class="card status-card" id="home-final-status" style="margin-bottom: 12px;">
                <div style="font-size: 16px; font-weight: 600; opacity: 0.95; margin-bottom: 5px;">ğŸ’° ì§€ê¸ˆ ìƒíƒœëŠ”?</div>
                <div class="status-amount" id="home-final-amount" style="font-size: 38px; margin: 12px 0;">0ì›</div>
                <div id="home-final-text" style="font-size: 15px; font-weight: 500;">ê³„ì‚° ì¤‘...</div>
            </div>

            <!-- í†µí•© ë§‰ëŒ€ ê·¸ë˜í”„ ì¹´ë“œ -->
            <div class="card">
                <!-- ëª©í‘œ ê¸ˆì•¡ - í”Œë¡œë‹ˆ ìŠ¤íƒ€ì¼ -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <div style="font-size: 13px; color: #64748b; font-weight: 500;">ğŸ¯ ì•„íŒŒíŠ¸ ëª©í‘œ ê¸ˆì•¡</div>
                    <div style="font-size: 20px; font-weight: 700; color: #10b981;" id="home-total-need-simple">5ì–µ 5,000ë§Œì›</div>
                </div>

                <!-- ì§„í–‰ë¥  ë§‰ëŒ€ -->
                <div class="progress-bar" style="height: 12px; background: #f1f5f9; margin-bottom: 20px;">
                    <div id="home-main-progress" style="height: 100%; background: linear-gradient(90deg, #10b981 0%, #059669 100%); transition: width 0.5s; border-radius: 10px;"></div>
                </div>
                <div style="text-align: right; font-size: 13px; color: #64748b; margin-top: -15px; margin-bottom: 20px;" id="home-progress-percent">0%</div>

                <!-- í•­ëª©ë³„ ë¦¬ìŠ¤íŠ¸ -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                        <span style="color: #666; font-size: 14px;">âœ“ ì´ë¯¸ ë‚¸ ëˆ</span>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; font-size: 15px;" id="home-paid-simple">0ì›</div>
                            <div style="font-size: 12px; color: #22c55e;" id="home-paid-percent">(0%)</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                        <span style="color: #666; font-size: 14px;">ğŸ’° ë³´ìœ  í˜„ê¸ˆ</span>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; font-size: 15px;" id="home-cash-simple">0ì›</div>
                            <div style="font-size: 12px; color: #3b82f6;" id="home-cash-percent">(0%)</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 2px solid #cbd5e1;">
                        <span style="color: #666; font-size: 14px;">ğŸ¦ ëŒ€ì¶œ ê°€ëŠ¥</span>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; font-size: 15px;" id="home-loan-simple">0ì›</div>
                            <div style="font-size: 12px; color: #3b82f6;" id="home-loan-percent">(0%)</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0;">
                        <span style="font-weight: 600; font-size: 14px;" id="home-shortage-label">ğŸ”´ ë¶€ì¡±</span>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; font-size: 16px;" id="home-shortage-amount">0ì›</div>
                            <div style="font-size: 12px;" id="home-shortage-percent">(0%)</div>
                        </div>
                    </div>
                </div>

                <!-- ìƒì„¸ë³´ê¸° ë²„íŠ¼ -->
                <button class="btn btn-primary" onclick="showBudgetEdit()" style="margin-top: 15px;">âœï¸ ìê¸ˆê³„íš ìˆ˜ì •</button>
                
                <!-- ìƒì„¸ ë‚´ì—­ ì ‘ê¸°/í¼ì¹˜ê¸° -->
                <div style="margin-top: 15px; cursor: pointer; text-align: center; color: #10b981; font-weight: 500;" onclick="toggleDetail()">
                    <span id="detail-toggle">â–¼ ìƒì„¸ ë‚´ì—­ ë³´ê¸°</span>
                </div>
                
                <div id="detail-content" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 2px solid #f0f0f0;">
                    <!-- ì´ í•„ìš” ê¸ˆì•¡ ìƒì„¸ -->
                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #10b981; font-size: 14px;">ğŸ’° ì´ í•„ìš” ê¸ˆì•¡ êµ¬ì„±</div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">ğŸ“‹ ë¶„ì–‘ê°€</span>
                                <span style="font-weight: 500;" id="detail-base-price">0ì›</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">â• ì¤‘ë„ê¸ˆ ì´ì</span>
                                <span style="font-weight: 500;" id="detail-interest">0ì›</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">â• ì˜µì…˜</span>
                                <span style="font-weight: 500;" id="detail-options">0ì›</span>
                            </div>
                        </div>
                    </div>

                    <!-- ì´ë¯¸ ë‚¸ ëˆ ìƒì„¸ -->
                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #10b981; font-size: 14px;">âœ… ì´ë¯¸ ë‚¸ ëˆ êµ¬ì„±</div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">ğŸ’³ ì¤‘ë„ê¸ˆ ë‚©ë¶€</span>
                                <span style="font-weight: 500;" id="detail-paid-deposit">0ì›</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">ğŸ’° ì™„ë£Œëœ ì§€ì¶œ</span>
                                <span style="font-weight: 500;" id="detail-paid-expenses">0ì›</span>
                            </div>
                        </div>
                    </div>

                    <!-- ëŒ€ì¶œ ì •ë³´ -->
                    <div>
                        <div style="font-weight: 600; margin-bottom: 10px; color: #10b981; font-size: 14px;">ğŸ¦ ëŒ€ì¶œ ì •ë³´</div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">ì§‘ ê°’</span>
                                <span style="font-weight: 500;" id="detail-home-price">0ì›</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">LTV ë¹„ìœ¨</span>
                                <span style="font-weight: 500;" id="detail-ltv">70%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px; border-bottom: 1px solid #e0e0e0; padding-bottom: 8px; margin-bottom: 5px;">
                                <span style="color: #666;">ğŸ’° ëŒ€ì¶œ ê°€ëŠ¥ ê¸ˆì•¡</span>
                                <span style="font-weight: 600; color: #10b981;" id="detail-loan-available">0ì›</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px;">
                                <span style="color: #666;">ì¤‘ë„ê¸ˆ ëŒ€ì¶œ ì´ììœ¨</span>
                                <span style="font-weight: 500;" id="detail-loan-rate">0%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px; border-top: 1px solid #e0e0e0; padding-top: 8px; margin-top: 5px;">
                                <span style="color: #666;">ğŸ’¸ ì›” ëŒ€ì¶œ ì´ì</span>
                                <span style="font-weight: 600; color: #ef4444;" id="detail-monthly-interest">0ì›</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ì €ì¶• í˜„í™© -->
            <div class="card">
                <div class="card-title">ğŸ  ì¸í…Œë¦¬ì–´/ê°€ì „/ê°€êµ¬ ìê¸ˆ ëª¨ìœ¼ê¸°</div>
                <div class="amount-row">
                    <span class="amount-label">ëª©í‘œ</span>
                    <span class="amount-value" id="home-savings-goal">0ì›</span>
                </div>
                <div class="amount-row">
                    <span class="amount-label">ë‹¬ì„±</span>
                    <span class="amount-value" id="home-savings-current">0ì›</span>
                </div>
                <div class="progress-bar" style="background: #e2e8f0; margin-top: 10px;">
                    <div class="progress-fill" id="home-savings-progress" style="background: #10b981;"></div>
                </div>
                <div style="text-align: center; margin-top: 10px; color: #64748b; font-size: 14px;" id="home-savings-text">0%</div>
            </div>
        </div>

        <!-- ì§€ì¶œê´€ë¦¬ íƒ­ -->
        <div id="expenses" class="tab-content">
            <!-- ì¸í…Œë¦¬ì–´/ê°€ì „/ê°€êµ¬ ì˜ˆì‚° íŠ¸ë˜ì»¤ -->
            <div class="card mint-card">
                <div style="font-weight: 600; font-size: 15px; margin-bottom: 15px; opacity: 0.9;">ğŸ  ì¸í…Œë¦¬ì–´/ê°€ì „/ê°€êµ¬ ì˜ˆì‚°</div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span style="font-size: 13px; opacity: 0.85;">ì˜ˆì‚°</span>
                    <span style="font-size: 18px; font-weight: 600;" id="furniture-budget-total">3,000ë§Œì›</span>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <span style="font-size: 13px; opacity: 0.85;">ì‚¬ìš©</span>
                    <span style="font-size: 18px; font-weight: 600;" id="furniture-budget-used">0ë§Œì›</span>
                </div>
                
                <div class="progress-bar" style="background: rgba(255,255,255,0.3); height: 10px; margin-bottom: 12px;">
                    <div id="furniture-progress" style="height: 100%; background: white; border-radius: 10px; transition: width 0.3s;"></div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 13px; opacity: 0.85;">ë‚¨ì€ ì˜ˆì‚°</span>
                    <span class="big-amount" style="font-size: 24px; margin: 0;" id="furniture-budget-remaining">3,000ë§Œì›</span>
                </div>
            </div>

            <!-- ë¹ ë¥¸ ì¶”ê°€ ë²„íŠ¼ -->
            <button class="btn btn-primary" onclick="showAddExpense()" style="margin-bottom: 15px;">+ í•­ëª© ì¶”ê°€</button>
            
            <!-- ì„¹ì…˜ í—¤ë”: ì§€ì¶œ ë‚´ì—­ -->
            <div style="padding: 12px 0 12px 0; margin-bottom: 12px;">
                <div style="font-size: 15px; font-weight: 700; color: #1e293b; display: flex; align-items: center; gap: 8px;">
                    <div style="width: 4px; height: 18px; background: linear-gradient(180deg, #10b981 0%, #059669 100%); border-radius: 2px;"></div>
                    ğŸ“‹ ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ ë‚´ì—­
                </div>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ ë‚´ì—­ -->
            <div id="expenses-list">
                <div style="color: #94a3b8; text-align: center; padding: 40px 0;">ë“±ë¡ëœ ì§€ì¶œì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
        </div>

        <!-- ìê¸ˆí˜„í™© íƒ­ -->
        <div id="savings" class="tab-content">
            <!-- ì„¹ì…˜ í—¤ë”: ë³´ìœ  ìê¸ˆ -->
            <div style="padding: 16px 0 12px 0; margin-bottom: 12px;">
                <div style="font-size: 15px; font-weight: 700; color: #1e293b; display: flex; align-items: center; gap: 8px;">
                    <div style="width: 4px; height: 18px; background: linear-gradient(180deg, #10b981 0%, #059669 100%); border-radius: 2px;"></div>
                    ğŸ’° ë³´ìœ  ìê¸ˆ
                </div>
            </div>

            <!-- ì´ ë³´ìœ  í˜„ê¸ˆ -->
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 16px 20px; border-radius: 16px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2); display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 14px; opacity: 0.9;">ğŸ’° ì´ ë³´ìœ  í˜„ê¸ˆ</div>
                <div style="font-size: 24px; font-weight: 700;" id="total-cash-display">0ë§Œì›</div>
            </div>

            <!-- ë³´ìœ  í˜„ê¸ˆ ë¦¬ìŠ¤íŠ¸ -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div class="card-title" style="margin: 0;">ğŸ’³ ë³´ìœ  í˜„ê¸ˆ ë‚´ì—­</div>
                    <button class="btn btn-primary" onclick="showAddCash()" style="width: auto; padding: 8px 15px; font-size: 14px;">+ ì¶”ê°€</button>
                </div>
                <div id="cash-list">
                    <div style="color: #999; text-align: center; padding: 20px 0;">ë“±ë¡ëœ í˜„ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤</div>
                </div>
            </div>

            <!-- ì„¹ì…˜ í—¤ë”: ì €ì¶• ê´€ë¦¬ -->
            <div style="padding: 24px 0 12px 0; margin-bottom: 12px;">
                <div style="font-size: 15px; font-weight: 700; color: #1e293b; display: flex; align-items: center; gap: 8px;">
                    <div style="width: 4px; height: 18px; background: linear-gradient(180deg, #10b981 0%, #059669 100%); border-radius: 2px;"></div>
                    ğŸ  ì €ì¶• ê´€ë¦¬
                </div>
            </div>

            <!-- ì €ì¶• ëª©í‘œ & ì €ê¸ˆí†µ & ë‹¬ë ¥ -->
            <div class="card">
                <div class="card-title">ğŸ¯ ì¸í…Œë¦¬ì–´/ê°€ì „/ê°€êµ¬ ìê¸ˆ ëª¨ìœ¼ê¸°</div>
                
                <!-- ì €ì¶• í˜„í™© ì¹´ë“œ -->
                <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 20px; border-radius: 16px; margin: 20px 0; border: 2px solid #10b981;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div>
                            <div style="font-size: 13px; color: #059669; font-weight: 600; margin-bottom: 6px;">í˜„ì¬ ëª¨ì€ ê¸ˆì•¡</div>
                            <div style="font-size: 32px; font-weight: 700; color: #059669;" id="piggy-saved">0ë§Œì›</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 13px; color: #64748b; margin-bottom: 6px;">ëª©í‘œ</div>
                            <input type="number" id="piggy-goal" placeholder="2000" style="font-size: 20px; font-weight: 600; color: #64748b; width: 100px; text-align: right; border: none; background: transparent; border-bottom: 2px solid #d1fae5; padding: 4px 0;">
                            <span style="font-size: 16px; color: #64748b; margin-left: 4px;">ë§Œì›</span>
                        </div>
                    </div>
                    
                    <!-- ì§„í–‰ë°” -->
                    <div class="progress-bar" style="background: rgba(16, 185, 129, 0.2); height: 12px; margin-bottom: 8px;">
                        <div id="piggy-progress" style="height: 100%; background: linear-gradient(90deg, #10b981 0%, #059669 100%); border-radius: 10px; transition: width 0.5s;"></div>
                    </div>
                    <div style="text-align: right; font-size: 14px; font-weight: 600; color: #059669;" id="piggy-percent">0%</div>
                </div>

                <!-- êµ¬ë¶„ì„  -->
                <div style="border-top: 1px solid #e2e8f0; margin: 24px 0;"></div>

                <!-- ì›”ë³„ ì €ì¶• ê¸°ë¡ -->
                <div style="font-size: 15px; font-weight: 600; color: #1e293b; margin-bottom: 16px;">ğŸ“… ì›”ë³„ ì €ì¶• ê¸°ë¡</div>
                
                <div style="margin: 16px 0; padding: 12px; background: #f0fdf4; border-radius: 8px; font-size: 13px; color: #059669;">
                    ğŸ’¡ ì›”ì„ í´ë¦­í•˜ì—¬ ì €ì¶• ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”
                </div>
                
                <!-- ì›”ë³„ ê·¸ë¦¬ë“œ (4ì—´ x 3í–‰) -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 16px;">
                    <!-- 1~12ì›” -->
                </div>
                <div id="monthly-savings-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 16px;">
                </div>
            </div>
        </div>

        <!-- ì¼ì •ê´€ë¦¬ íƒ­ -->
        <div id="schedule" class="tab-content">
            <button class="btn btn-primary" onclick="showAddSchedule()" style="margin-bottom: 15px;">+ ì¼ì • ì¶”ê°€</button>
            
            <!-- ì„¹ì…˜ í—¤ë”: ì¼ì • íƒ€ì„ë¼ì¸ -->
            <div style="padding: 12px 0 12px 0; margin-bottom: 12px;">
                <div style="font-size: 15px; font-weight: 700; color: #1e293b; display: flex; align-items: center; gap: 8px;">
                    <div style="width: 4px; height: 18px; background: linear-gradient(180deg, #10b981 0%, #059669 100%); border-radius: 2px;"></div>
                    ğŸ“… ì¼ì • íƒ€ì„ë¼ì¸
                </div>
            </div>

            <div class="timeline" id="schedule-list">
                <div style="color: #999; text-align: center; padding: 40px 0;">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
        </div>
    </div>

    <!-- í˜„ê¸ˆ ê³„ì¢Œ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="cash-modal" class="modal">
        <div class="modal-content">
            <div class="card-title">ğŸ’³ í˜„ê¸ˆ ê³„ì¢Œ ì¶”ê°€</div>
            <div class="input-group">
                <label class="input-label">ì´ë¦„ (ì˜ˆ: ìš°ë¦¬ì€í–‰, ì‹ í•œì¹´ë“œ, í˜„ê¸ˆ)</label>
                <input type="text" id="new-cash-name" placeholder="ìš°ë¦¬ì€í–‰">
            </div>
            <div class="input-group">
                <label class="input-label">ê¸ˆì•¡ (ë§Œì›)</label>
                <input type="number" id="new-cash-amount" placeholder="5000">
            </div>
            <div class="btn-row">
                <button class="btn btn-primary" onclick="addCashAccount()">ì¶”ê°€</button>
                <button class="btn btn-secondary" onclick="hideAddCash()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ìê¸ˆê³„íš ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="budget-modal" class="modal">
        <div class="modal-content">
            <div class="card-title">âœï¸ ìê¸ˆê³„íš ìˆ˜ì •</div>
            
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #10b981;">ğŸ’° ì´ í•„ìš” ê¸ˆì•¡</div>
                <div class="input-group">
                    <label class="input-label">ë¶„ì–‘ê°€ (ë§Œì›)</label>
                    <input type="number" id="budget-base-price" placeholder="ì˜ˆ: 52000">
                </div>
                <div class="input-group">
                    <label class="input-label">ì¤‘ë„ê¸ˆ ì´ì (ë§Œì›)</label>
                    <input type="number" id="budget-interest" placeholder="ì˜ˆ: 2000">
                </div>
                <div class="input-group">
                    <label class="input-label">ì˜µì…˜ ë¹„ìš© (ë§Œì›)</label>
                    <input type="number" id="budget-options" placeholder="ì˜ˆ: 1000">
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #10b981;">âœ… ì´ë¯¸ ë‚©ë¶€í•œ ê¸ˆì•¡</div>
                <div class="input-group">
                    <label class="input-label">ì¤‘ë„ê¸ˆ ë‚©ë¶€ì•¡ (ë§Œì›)</label>
                    <input type="number" id="budget-paid-deposit" placeholder="ì˜ˆ: 7000">
                </div>
                <div class="mini-card">
                    <div style="font-size: 13px; color: #666;">ğŸ’¡ ì™„ë£Œëœ ì§€ì¶œì€ ìë™ìœ¼ë¡œ í•©ì‚°ë©ë‹ˆë‹¤</div>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #10b981;">ğŸ’µ í˜„ì¬ ë³´ìœ  ìê¸ˆ</div>
                <div class="input-group">
                    <label class="input-label">ë³´ìœ  í˜„ê¸ˆ (ë§Œì›)</label>
                    <input type="number" id="budget-cash" placeholder="ì˜ˆ: 8000">
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #10b981;">ğŸ¦ ëŒ€ì¶œ ì •ë³´</div>
                <div class="input-group">
                    <label class="input-label">ì§‘ ê°’ (ë§Œì›)</label>
                    <input type="number" id="budget-home-price" placeholder="ì˜ˆ: 52000">
                </div>
                <div class="input-group">
                    <label class="input-label">ì¤‘ë„ê¸ˆ ëŒ€ì¶œì•¡ (ë§Œì›)</label>
                    <input type="number" id="budget-loan-deposit" placeholder="ì˜ˆ: 31200">
                </div>
                <div class="input-group">
                    <label class="input-label">ì¤‘ë„ê¸ˆ ëŒ€ì¶œ ì´ììœ¨ (%)</label>
                    <input type="number" step="0.01" id="budget-loan-rate" placeholder="ì˜ˆ: 4.5">
                </div>
                <div class="input-group">
                    <label class="input-label">LTV ë¹„ìœ¨ (%)</label>
                    <input type="number" id="budget-ltv" placeholder="ì˜ˆ: 70">
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #10b981;">ğŸ“… ì…ì£¼ ì˜ˆì •ì¼</div>
                <div class="input-group">
                    <input type="date" id="budget-move-date">
                </div>
            </div>

            <div class="mini-card" style="background: #f8f9ff; margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px;">ğŸ“Š ìë™ ê³„ì‚°</div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span style="font-size: 13px; color: #666;">LTV ê¸°ì¤€ ëŒ€ì¶œ ê°€ëŠ¥ì•¡</span>
                    <span style="font-weight: bold;" id="budget-ltv-amount">0ë§Œì›</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="font-size: 13px; color: #666;">ì›” ëŒ€ì¶œ ì´ì</span>
                    <span style="font-weight: bold;" id="budget-monthly-interest">0ë§Œì›</span>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-primary" onclick="saveBudget()">ì €ì¥</button>
                <button class="btn btn-secondary" onclick="hideBudgetEdit()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì¼ì • ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="schedule-modal" class="modal">
        <div class="modal-content">
            <div class="card-title">ğŸ“… ì¼ì • ì¶”ê°€</div>
            <div class="input-group">
                <label class="input-label">ì¼ì • ì œëª©</label>
                <input type="text" id="new-schedule-title" placeholder="ì˜ˆ: ì¤‘ë„ê¸ˆ 3ì°¨ ë‚©ë¶€">
            </div>
            <div class="input-group">
                <label class="input-label">ë‚ ì§œ</label>
                <input type="date" id="new-schedule-date">
            </div>
            <div class="input-group">
                <label class="input-label">ê¸ˆì•¡ (ë§Œì›, ì„ íƒì‚¬í•­)</label>
                <input type="number" id="new-schedule-amount" placeholder="ì˜ˆ: 1500">
            </div>
            <div class="input-group">
                <label class="input-label">ë©”ëª¨</label>
                <textarea id="new-schedule-memo" rows="2" placeholder="ë©”ëª¨ì‚¬í•­"></textarea>
            </div>
            <div class="btn-row">
                <button class="btn btn-primary" onclick="addSchedule()">ì¶”ê°€</button>
                <button class="btn btn-secondary" onclick="hideAddSchedule()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì§€ì¶œ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="expense-modal" class="modal">
        <div class="modal-content">
            <div class="card-title">ğŸ’³ ì§€ì¶œ í•­ëª© ì¶”ê°€</div>
            <div class="input-group">
                <label class="input-label">ì¹´í…Œê³ ë¦¬</label>
                <select id="new-expense-category">
                    <option>ì¸í…Œë¦¬ì–´</option>
                    <option>ê°€ì „</option>
                    <option>ê°€êµ¬</option>
                </select>
            </div>
            <div class="input-group">
                <label class="input-label">í•­ëª©ëª…</label>
                <input type="text" id="new-expense-item" placeholder="ì˜ˆ: ì‹œìŠ¤í…œ ì—ì–´ì»¨">
            </div>
            <div class="input-group">
                <label class="input-label">ì˜ˆì‚° (ë§Œì›)</label>
                <input type="number" id="new-expense-budget" placeholder="ì˜ˆ: 500">
            </div>
            <div class="input-group">
                <label class="input-label">ì‹¤ì œ ì§€ì¶œ (ë§Œì›)</label>
                <input type="number" id="new-expense-actual" placeholder="ì˜ˆ: 480">
            </div>
            <div class="input-group">
                <label class="input-label">ìƒíƒœ</label>
                <select id="new-expense-status">
                    <option>ì˜ˆì •</option>
                    <option>ì§„í–‰ì¤‘</option>
                    <option>ì™„ë£Œ</option>
                    <option>ë³´ë¥˜</option>
                </select>
            </div>
            <div class="input-group">
                <label class="input-label">ì˜ìˆ˜ì¦ ì‚¬ì§„</label>
                <input type="file" id="new-expense-receipt" accept="image/*">
            </div>
            <div class="input-group">
                <label class="input-label">ë©”ëª¨</label>
                <textarea id="new-expense-memo" rows="2" placeholder="ì—…ì²´ëª…, ì—°ë½ì²˜ ë“±"></textarea>
            </div>
            <div class="btn-row">
                <button class="btn btn-primary" onclick="addExpenseItem()">ì¶”ê°€</button>
                <button class="btn btn-secondary" onclick="hideAddExpense()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="bottom-nav">
        <button class="nav-item active" onclick="showTab('home')">
            <div class="nav-icon">ğŸ </div>
            <div class="nav-label">í™ˆ</div>
        </button>
        <button class="nav-item" onclick="showTab('expenses')">
            <div class="nav-icon">ğŸ’³</div>
            <div class="nav-label">ì§€ì¶œ</div>
        </button>
        <button class="nav-item" onclick="showTab('savings')">
            <div class="nav-icon">ğŸ’°</div>
            <div class="nav-label">ìê¸ˆ</div>
        </button>
        <button class="nav-item" onclick="showTab('schedule')">
            <div class="nav-icon">ğŸ“…</div>
            <div class="nav-label">ì¼ì •</div>
        </button>
    </nav>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script>
        // Firebase ì„¤ì •
        var firebaseConfig = {
            apiKey: "AIzaSyBk-gYVVYkMSzpJT-czDi8hgoZfFdMCH2g",
            authDomain: "apartment-7b7ef.firebaseapp.com",
            databaseURL: "https://apartment-7b7ef-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "apartment-7b7ef",
            storageBucket: "apartment-7b7ef.firebasestorage.app",
            messagingSenderId: "239142114950",
            appId: "1:239142114950:web:09c10faf8a42d47c782307",
            measurementId: "G-43CB551CV5"
        };
        
        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();
        var dataRef = database.ref('apartmentData');

        // ì—°ê²° ìƒíƒœ ì²´í¬
        var connectedRef = database.ref('.info/connected');
        connectedRef.on('value', function(snapshot) {
            var statusElement = document.getElementById('firebase-status');
            if (snapshot.val() === true) {
                statusElement.textContent = 'ğŸŸ¢ ì‹¤ì‹œê°„ ë™ê¸°í™” ì¤‘';
                statusElement.style.color = '#4ade80';
            } else {
                statusElement.textContent = 'ğŸ”´ ì—°ê²° ëŠê¹€';
                statusElement.style.color = '#ff4757';
            }
        });

        var data = {
            budget: {
                basePrice: 0,
                interest: 0,
                options: 0,
                extra: 0,
                paidDeposit: 0,
                cash: 0,
                homePrice: 0,
                loanDeposit: 0,
                loanRate: 0,
                ltv: 70
            },
            schedules: [],
            expenses: [],
            cashAccounts: [],
            savingGoal: 0,
            savingRecords: {},
            moveInDate: '2027-02-01'
        };

        var currentMonth = new Date();
        var calendarMonth = new Date();

        function toggleDetail() {
            var content = document.getElementById('detail-content');
            var toggle = document.getElementById('detail-toggle');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = 'â–² ìƒì„¸ ë‚´ì—­ ë‹«ê¸°';
            } else {
                content.style.display = 'none';
                toggle.textContent = 'â–¼ ìƒì„¸ ë‚´ì—­ ë³´ê¸°';
            }
        }

        function showAddCash() {
            document.getElementById('cash-modal').classList.add('active');
        }

        function hideAddCash() {
            document.getElementById('cash-modal').classList.remove('active');
            document.getElementById('new-cash-name').value = '';
            document.getElementById('new-cash-amount').value = '';
        }

        function addCashAccount() {
            var name = document.getElementById('new-cash-name').value;
            var amount = Number(document.getElementById('new-cash-amount').value);
            
            if (!name || !amount) {
                alert('ì´ë¦„ê³¼ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            data.cashAccounts.push({
                id: Date.now(),
                name: name,
                amount: amount
            });
            
            saveData();
            hideAddCash();
        }

        function deleteCashAccount(id) {
            if (confirm('ì´ ê³„ì¢Œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                data.cashAccounts = data.cashAccounts.filter(function(acc) {
                    return acc.id !== id;
                });
                saveData();
            }
        }

        function editCashAccount(id) {
            var account = data.cashAccounts.find(function(acc) {
                return acc.id === id;
            });
            
            if (!account) return;
            
            var newAmount = prompt('ìƒˆ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (ë§Œì›)', account.amount);
            if (newAmount !== null && newAmount !== '') {
                account.amount = Number(newAmount);
                saveData();
            }
        }

        function updateCashList() {
            var html = '';
            var total = 0;
            
            for (var i = 0; i < data.cashAccounts.length; i++) {
                var acc = data.cashAccounts[i];
                total += acc.amount;
                
                html += '<div style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 12px 16px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">';
                html += '<div>';
                html += '<div style="font-weight: 600; font-size: 14px; color: #1e293b;">' + acc.name + '</div>';
                html += '<div style="color: #10b981; font-weight: 700; font-size: 16px; margin-top: 2px;">' + formatWon(acc.amount) + '</div>';
                html += '</div>';
                html += '<div style="display: flex; gap: 6px;">';
                html += '<button onclick="editCashAccount(' + acc.id + ')" style="background: #f0fdf4; border: 1px solid #d1fae5; color: #059669; padding: 6px 12px; border-radius: 8px; font-size: 12px; cursor: pointer; font-weight: 600;">ìˆ˜ì •</button>';
                html += '<button onclick="deleteCashAccount(' + acc.id + ')" style="background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; padding: 6px 12px; border-radius: 8px; font-size: 12px; cursor: pointer; font-weight: 600;">ì‚­ì œ</button>';
                html += '</div>';
                html += '</div>';
            }
            
            document.getElementById('cash-list').innerHTML = html || '<div style="color: #999; text-align: center; padding: 20px 0;">ë“±ë¡ëœ í˜„ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤</div>';
            document.getElementById('total-cash-display').textContent = formatWon(total);
            
            // data.budget.cash ì—…ë°ì´íŠ¸
            data.budget.cash = total;
        }

        function editMoveInDate() {
            var currentDate = data.moveInDate || '';
            var newDate = prompt('ì…ì£¼ ì˜ˆì •ì¼ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 2025-12-31)', currentDate);
            
            if (newDate) {
                data.moveInDate = newDate;
                saveData();
            }
        }

        function showBudgetEdit() {
            document.getElementById('budget-modal').classList.add('active');
            updateBudgetModal();
        }

        function hideBudgetEdit() {
            document.getElementById('budget-modal').classList.remove('active');
        }

        function saveBudget() {
            var moveDate = document.getElementById('budget-move-date').value;
            if (moveDate) {
                data.moveInDate = moveDate;
            }
            saveData();
            hideBudgetEdit();
        }

        function updateBudgetModal() {
            document.getElementById('budget-base-price').value = data.budget.basePrice || '';
            document.getElementById('budget-interest').value = data.budget.interest || '';
            document.getElementById('budget-options').value = data.budget.options || '';
            document.getElementById('budget-paid-deposit').value = data.budget.paidDeposit || '';
            document.getElementById('budget-cash').value = data.budget.cash || '';
            document.getElementById('budget-home-price').value = data.budget.homePrice || '';
            document.getElementById('budget-loan-deposit').value = data.budget.loanDeposit || '';
            document.getElementById('budget-loan-rate').value = data.budget.loanRate || '';
            document.getElementById('budget-ltv').value = data.budget.ltv || 70;
            document.getElementById('budget-move-date').value = data.moveInDate || '';
            
            updateBudgetCalculations();
        }

        function updateBudgetCalculations() {
            var ltvAmount = 0;
            if (data.budget.homePrice > 0 && data.budget.ltv > 0) {
                ltvAmount = Math.floor(data.budget.homePrice * data.budget.ltv / 100);
            }
            document.getElementById('budget-ltv-amount').textContent = formatNumber(ltvAmount) + 'ë§Œì›';
            
            var monthlyInterest = 0;
            if (data.budget.loanDeposit > 0 && data.budget.loanRate > 0) {
                monthlyInterest = Math.round(data.budget.loanDeposit * (data.budget.loanRate / 100) / 12);
            }
            document.getElementById('budget-monthly-interest').textContent = formatNumber(monthlyInterest) + 'ë§Œì›';
        }

        function loadData() {
            // ì´ˆê¸° ë°ì´í„° í•œ ë²ˆë§Œ ë¶ˆëŸ¬ì˜¤ê¸°
            dataRef.once('value').then(function(snapshot) {
                var firebaseData = snapshot.val();
                if (firebaseData) {
                    data = firebaseData;
                    console.log('âœ… Firebase ë°ì´í„° ë¡œë“œ:', data);
                } else {
                    // Firebaseì— ë°ì´í„° ì—†ìœ¼ë©´ localStorage ì²´í¬
                    var saved = localStorage.getItem('newHomeBudget');
                    if (saved) {
                        data = JSON.parse(saved);
                        console.log('ğŸ“¦ localStorage ë°ì´í„° ë¡œë“œ:', data);
                    }
                }
                
                // ê¸°ì¡´ ë°ì´í„°ì— ìƒˆ í•„ë“œ ì¶”ê°€
                if (!data.cashAccounts) data.cashAccounts = [];
                if (!data.savingRecords) data.savingRecords = {};
                if (!data.savingGoal) data.savingGoal = 0;
                
                currentMonth = new Date();
                calendarMonth = new Date();
                updateAllUI();
                
                // ì´ì œ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ (ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ë³€ê²½ ê°ì§€)
                setupRealtimeListener();
            }).catch(function(error) {
                console.error('âŒ Firebase ë¡œë“œ ì‹¤íŒ¨:', error);
                // Firebase ì‹¤íŒ¨ ì‹œ localStorage ì‚¬ìš©
                var saved = localStorage.getItem('newHomeBudget');
                if (saved) {
                    data = JSON.parse(saved);
                    console.log('ğŸ“¦ localStorage ë°ì´í„° ë¡œë“œ (Firebase ì‹¤íŒ¨):', data);
                }
                if (!data.cashAccounts) data.cashAccounts = [];
                if (!data.savingRecords) data.savingRecords = {};
                if (!data.savingGoal) data.savingGoal = 0;
                
                currentMonth = new Date();
                calendarMonth = new Date();
                updateAllUI();
            });
        }

        var isUpdatingFromFirebase = false;
        
        function setupRealtimeListener() {
            dataRef.on('value', function(snapshot) {
                if (isUpdatingFromFirebase) return; // ë‚´ê°€ ì €ì¥í•œ ê±°ë©´ ë¬´ì‹œ
                
                var firebaseData = snapshot.val();
                if (firebaseData) {
                    data = firebaseData;
                    if (!data.cashAccounts) data.cashAccounts = [];
                    if (!data.savingRecords) data.savingRecords = {};
                    if (!data.savingGoal) data.savingGoal = 0;
                    updateAllUI();
                    console.log('ğŸ”„ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ì—…ë°ì´íŠ¸ë¨!');
                }
            });
        }

        function saveData() {
            isUpdatingFromFirebase = true; // í”Œë˜ê·¸ ì„¤ì •
            
            // localStorageì—ë„ ì¦‰ì‹œ ì €ì¥ (ë°±ì—…)
            localStorage.setItem('newHomeBudget', JSON.stringify(data));
            console.log('ğŸ’¾ localStorage ì €ì¥ ì™„ë£Œ');
            
            // Firebaseì— ì €ì¥
            dataRef.set(data).then(function() {
                console.log('âœ… Firebase ì €ì¥ ì™„ë£Œ!');
                setTimeout(function() {
                    isUpdatingFromFirebase = false; // í”Œë˜ê·¸ í•´ì œ
                }, 500);
            }).catch(function(error) {
                console.error('âŒ Firebase ì €ì¥ ì‹¤íŒ¨:', error);
                isUpdatingFromFirebase = false;
            });
            
            // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            updateAllUI();
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(num);
        }

        function formatWon(num) {
            if (num >= 10000) {
                var eok = Math.floor(num / 10000);
                var man = num % 10000;
                if (man === 0) {
                    return eok + 'ì–µì›';
                }
                return eok + 'ì–µ ' + formatNumber(man) + 'ë§Œì›';
            }
            return formatNumber(num) + 'ë§Œì›';
        }

        function showTab(tabName) {
            // íƒ­ ì»¨í…ì¸  ì „í™˜
            var contents = document.querySelectorAll('.tab-content');
            for (var i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            document.getElementById(tabName).classList.add('active');
            
            // í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ active ì²˜ë¦¬
            var navItems = document.querySelectorAll('.nav-item');
            for (var i = 0; i < navItems.length; i++) {
                navItems[i].classList.remove('active');
            }
            
            // íƒ­ ì´ë¦„ì— ë”°ë¼ í•´ë‹¹ ë„¤ë¹„ê²Œì´ì…˜ ì•„ì´í…œì— active ì¶”ê°€
            var index = 0;
            if (tabName === 'home') index = 0;
            else if (tabName === 'expenses') index = 1;
            else if (tabName === 'savings') index = 2;
            else if (tabName === 'schedule') index = 3;
            
            if (navItems[index]) {
                navItems[index].classList.add('active');
            }
        }

        function updateAllUI() {
            updateHomeTab();
            updateScheduleList();
            updateExpensesList();
            updateSavingsTab();
        }

        function updateHomeTab() {
            var totalNeed = data.budget.basePrice + data.budget.interest + data.budget.options;
            
            var completedExpenses = 0;
            for (var i = 0; i < data.expenses.length; i++) {
                if (data.expenses[i].status === 'ì™„ë£Œ') {
                    completedExpenses += Number(data.expenses[i].actual);
                }
            }
            var totalPaid = data.budget.paidDeposit + completedExpenses;
            
            var loanAvailable = 0;
            if (data.budget.homePrice > 0 && data.budget.ltv > 0) {
                loanAvailable = Math.floor(data.budget.homePrice * data.budget.ltv / 100);
            }
            var totalAvailable = data.budget.cash + loanAvailable;
            
            // ì˜¬ë°”ë¥¸ ê³„ì‚°: (ì´ë¯¸ ë‚¸ ëˆ + ë³´ìœ  í˜„ê¸ˆ + ëŒ€ì¶œ ê°€ëŠ¥) - ì´ í•„ìš”
            var secured = totalPaid + totalAvailable;
            var finalAmount = secured - totalNeed;
            
            // ìµœì¢… ìƒíƒœ ì¹´ë“œ
            var statusCard = document.getElementById('home-final-status');
            var statusAmount = document.getElementById('home-final-amount');
            var statusText = document.getElementById('home-final-text');
            
            if (finalAmount < 0) {
                // ë¶€ì¡±í•œ ê²½ìš° (ìŒìˆ˜)
                statusCard.className = 'card status-card warning';
                statusAmount.textContent = formatWon(Math.abs(finalAmount));
                statusText.innerHTML = 'ğŸ”´ ë¶€ì¡± - ë” ëª¨ì•„ì•¼ í•´ìš”!';
            } else {
                // ì—¬ìœ  ìˆëŠ” ê²½ìš° (ì–‘ìˆ˜)
                statusCard.className = 'card status-card success';
                statusAmount.textContent = formatWon(Math.abs(finalAmount));
                statusText.innerHTML = 'ğŸŸ¢ ì—¬ìœ  - ì—¬ìœ ìˆì–´ìš”! ğŸ‘';
            }
            
            // í†µí•© ë§‰ëŒ€ ê·¸ë˜í”„
            document.getElementById('home-total-need-simple').textContent = formatWon(totalNeed);
            
            // ì§„í–‰ë¥  ê³„ì‚° (ì´ë¯¸ ë‚¸ ëˆ + ë³´ìœ  ê°€ëŠ¥í•œ ëˆ)
            var progressPercent = totalNeed > 0 ? Math.min((secured / totalNeed) * 100, 100) : 0;
            document.getElementById('home-main-progress').style.width = progressPercent + '%';
            document.getElementById('home-progress-percent').textContent = Math.round(progressPercent) + '%';
            
            // ì´ë¯¸ ë‚¸ ëˆ
            var paidPercent = totalNeed > 0 ? (totalPaid / totalNeed) * 100 : 0;
            document.getElementById('home-paid-simple').textContent = formatWon(totalPaid);
            document.getElementById('home-paid-percent').textContent = '(' + Math.round(paidPercent) + '%)';
            
            // ë³´ìœ  í˜„ê¸ˆ
            var cashPercent = totalNeed > 0 ? (data.budget.cash / totalNeed) * 100 : 0;
            document.getElementById('home-cash-simple').textContent = formatWon(data.budget.cash);
            document.getElementById('home-cash-percent').textContent = '(' + Math.round(cashPercent) + '%)';
            
            // ëŒ€ì¶œ ê°€ëŠ¥
            var loanPercent = totalNeed > 0 ? (loanAvailable / totalNeed) * 100 : 0;
            document.getElementById('home-loan-simple').textContent = formatWon(loanAvailable);
            document.getElementById('home-loan-percent').textContent = '(' + Math.round(loanPercent) + '%)';
            
            // ë¶€ì¡±/ì—¬ìœ 
            var shortagePercent = totalNeed > 0 ? (Math.abs(finalAmount) / totalNeed) * 100 : 0;
            if (finalAmount < 0) {
                // ë¶€ì¡±
                document.getElementById('home-shortage-label').textContent = 'ğŸ”´ ë¶€ì¡±';
                document.getElementById('home-shortage-amount').textContent = formatWon(Math.abs(finalAmount));
                document.getElementById('home-shortage-amount').style.color = '#ef4444';
                document.getElementById('home-shortage-percent').textContent = '(' + Math.round(shortagePercent) + '%)';
                document.getElementById('home-shortage-percent').style.color = '#ef4444';
            } else {
                // ì—¬ìœ 
                document.getElementById('home-shortage-label').textContent = 'ğŸŸ¢ ì—¬ìœ ';
                document.getElementById('home-shortage-amount').textContent = formatWon(Math.abs(finalAmount));
                document.getElementById('home-shortage-amount').style.color = '#22c55e';
                document.getElementById('home-shortage-percent').textContent = '(' + Math.round(shortagePercent) + '%)';
                document.getElementById('home-shortage-percent').style.color = '#22c55e';
            }
            
            // D-day (í—¤ë”ì—ë„ ì—…ë°ì´íŠ¸)
            if (data.moveInDate) {
                var today = new Date();
                var moveIn = new Date(data.moveInDate);
                var diff = Math.ceil((moveIn - today) / (1000 * 60 * 60 * 24));
                document.getElementById('header-dday').textContent = 'D-' + diff;
            }
            
            // ì €ì¶•
            var totalSaved = 0;
            for (var date in data.savingRecords) {
                totalSaved += data.savingRecords[date];
            }
            var goal = data.savingGoal || 0;
            var savingsPercent = goal > 0 ? Math.min((totalSaved / goal) * 100, 100) : 0;
            
            document.getElementById('home-savings-goal').textContent = formatWon(goal);
            document.getElementById('home-savings-current').textContent = formatWon(totalSaved);
            document.getElementById('home-savings-progress').style.width = savingsPercent + '%';
            document.getElementById('home-savings-text').textContent = Math.round(savingsPercent) + '%';
            
            // ìƒì„¸ ë‚´ì—­ ì—…ë°ì´íŠ¸
            document.getElementById('detail-base-price').textContent = formatWon(data.budget.basePrice);
            document.getElementById('detail-interest').textContent = formatWon(data.budget.interest);
            document.getElementById('detail-options').textContent = formatWon(data.budget.options);
            document.getElementById('detail-paid-deposit').textContent = formatWon(data.budget.paidDeposit);
            document.getElementById('detail-paid-expenses').textContent = formatWon(completedExpenses);
            document.getElementById('detail-home-price').textContent = formatWon(data.budget.homePrice);
            document.getElementById('detail-ltv').textContent = data.budget.ltv + '%';
            document.getElementById('detail-loan-rate').textContent = data.budget.loanRate + '%';
            
            // ëŒ€ì¶œ ê°€ëŠ¥ ê¸ˆì•¡
            document.getElementById('detail-loan-available').textContent = formatWon(loanAvailable);
            
            var monthlyInterest = 0;
            if (data.budget.loanDeposit > 0 && data.budget.loanRate > 0) {
                monthlyInterest = Math.round(data.budget.loanDeposit * (data.budget.loanRate / 100) / 12);
            }
            document.getElementById('detail-monthly-interest').textContent = formatWon(monthlyInterest);
        }

        function updateScheduleList() {
            var sorted = data.schedules.slice().sort(function(a, b) {
                return new Date(a.date) - new Date(b.date);
            });
            
            var html = '';
            for (var i = 0; i < sorted.length; i++) {
                var sch = sorted[i];
                var isDone = sch.status === 'ì™„ë£Œ';
                
                html += '<div class="timeline-item' + (isDone ? ' done' : '') + '">';
                if (i < sorted.length - 1) {
                    html += '<div class="timeline-line"></div>';
                }
                html += '<div style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 14px 16px; margin-bottom: 8px;">';
                html += '<div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">';
                html += '<div>';
                html += '<div style="font-weight: 600; font-size: 15px; color: #1e293b;">' + sch.title + '</div>';
                html += '<div style="font-size: 13px; color: #64748b; margin-top: 4px;">ğŸ“… ' + sch.date + '</div>';
                if (sch.amount > 0) {
                    html += '<div style="font-size: 14px; font-weight: 700; color: #10b981; margin-top: 6px;">ğŸ’° ' + formatWon(sch.amount) + '</div>';
                }
                html += '</div>';
                html += '<button onclick="deleteSchedule(' + sch.id + ')" style="background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; padding: 6px 12px; border-radius: 8px; font-size: 12px; cursor: pointer; font-weight: 600;">ì‚­ì œ</button>';
                html += '</div>';
                if (sch.memo) {
                    html += '<div style="margin-top: 10px; font-size: 13px; color: #64748b; padding: 10px; background: #f8fafc; border-radius: 8px;">' + sch.memo + '</div>';
                }
                html += '<div style="margin-top: 10px;">';
                html += '<label style="font-size: 13px; color: #64748b; cursor: pointer; display: inline-flex; align-items: center; gap: 6px;">';
                html += '<input type="checkbox" ' + (isDone ? 'checked' : '') + ' onchange="toggleScheduleStatus(' + sch.id + ')" style="cursor: pointer;"> ì™„ë£Œ';
                html += '</label>';
                html += '</div>';
                html += '</div></div>';
            }
            
            document.getElementById('schedule-list').innerHTML = html || '<div style="color: #999; text-align: center; padding: 40px 0;">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        }

        function updateExpensesList() {
            var furnitureCategories = ['ì¸í…Œë¦¬ì–´', 'ê°€ì „', 'ê°€êµ¬'];
            var html = '';
            var totalUsed = 0;
            
            for (var c = 0; c < furnitureCategories.length; c++) {
                var cat = furnitureCategories[c];
                var catExpenses = [];
                
                for (var i = 0; i < data.expenses.length; i++) {
                    if (data.expenses[i].category === cat) {
                        catExpenses.push(data.expenses[i]);
                        totalUsed += Number(data.expenses[i].actual) || 0;
                    }
                }
                
                if (catExpenses.length > 0) {
                    html += '<div class="category-header">' + cat + '</div>';
                    
                    for (var i = 0; i < catExpenses.length; i++) {
                        var exp = catExpenses[i];
                        html += '<div style="background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 14px 16px; margin-bottom: 8px;">';
                        html += '<div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">';
                        html += '<div style="display: flex; align-items: center; gap: 8px;">';
                        html += '<div style="font-weight: 600; font-size: 15px; color: #1e293b;">' + exp.item + '</div>';
                        html += '<span style="font-size: 11px; padding: 3px 8px; border-radius: 12px; ' + (exp.status === 'ì™„ë£Œ' ? 'background: #d1fae5; color: #065f46;' : 'background: #e2e8f0; color: #475569;') + '">' + exp.status + '</span>';
                        html += '</div>';
                        html += '<button onclick="deleteExpense(' + exp.id + ')" style="background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; padding: 6px 12px; border-radius: 8px; font-size: 12px; cursor: pointer; font-weight: 600;">ì‚­ì œ</button>';
                        html += '</div>';
                        html += '<div style="margin-top: 8px;">';
                        html += '<div style="display: flex; justify-content: space-between; margin-bottom: 6px;">';
                        html += '<span style="color: #64748b; font-size: 13px;">ì˜ˆì‚°</span>';
                        html += '<span style="font-weight: 600; font-size: 14px;">' + formatWon(exp.budget) + '</span>';
                        html += '</div>';
                        html += '<div style="display: flex; justify-content: space-between;">';
                        html += '<span style="color: #64748b; font-size: 13px;">ì‹¤ì œ</span>';
                        html += '<span style="font-weight: 700; color: #dc2626; font-size: 14px;">' + formatWon(exp.actual) + '</span>';
                        html += '</div>';
                        html += '</div>';
                        if (exp.memo) {
                            html += '<div style="margin-top: 10px; font-size: 13px; color: #64748b; padding: 10px; background: #f8fafc; border-radius: 8px;">' + exp.memo + '</div>';
                        }
                        if (exp.receipt) {
                            html += '<img src="' + exp.receipt + '" class="receipt-img">';
                        }
                        html += '</div>';
                    }
                }
            }
            
            document.getElementById('expenses-list').innerHTML = html || '<div style="color: #999; text-align: center; padding: 40px 0;">ë“±ë¡ëœ ì§€ì¶œì´ ì—†ìŠµë‹ˆë‹¤</div>';
            
            // ì˜ˆì‚° íŠ¸ë˜ì»¤ ì—…ë°ì´íŠ¸
            var furnitureBudget = data.budget.extra || 0;
            var remaining = furnitureBudget - totalUsed;
            var usedPercent = furnitureBudget > 0 ? (totalUsed / furnitureBudget) * 100 : 0;
            
            document.getElementById('furniture-budget-total').textContent = formatWon(furnitureBudget);
            document.getElementById('furniture-budget-used').textContent = formatWon(totalUsed);
            document.getElementById('furniture-budget-remaining').textContent = formatWon(remaining);
            document.getElementById('furniture-progress').style.width = Math.min(usedPercent, 100) + '%';
        }

        function updateSavingsTab() {
            // í˜„ê¸ˆ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            updateCashList();
            
            // ì €ê¸ˆí†µ ì—…ë°ì´íŠ¸
            var goal = data.savingGoal || 0;
            var totalSaved = 0;
            
            for (var date in data.savingRecords) {
                totalSaved += data.savingRecords[date];
            }
            
            document.getElementById('piggy-goal').value = goal || '';
            document.getElementById('piggy-saved').textContent = formatWon(totalSaved);
            
            var percent = goal > 0 ? Math.min((totalSaved / goal) * 100, 100) : 0;
            document.getElementById('piggy-progress').style.width = percent + '%';
            document.getElementById('piggy-percent').textContent = Math.round(percent) + '%';
            
            // ì›”ë³„ ê·¸ë¦¬ë“œ ë Œë”ë§
            renderMonthlySavings();
        }

        function showAddSchedule() {
            document.getElementById('schedule-modal').classList.add('active');
        }

        function hideAddSchedule() {
            document.getElementById('schedule-modal').classList.remove('active');
            document.getElementById('new-schedule-title').value = '';
            document.getElementById('new-schedule-date').value = '';
            document.getElementById('new-schedule-amount').value = '';
            document.getElementById('new-schedule-memo').value = '';
        }

        function addSchedule() {
            var title = document.getElementById('new-schedule-title').value;
            var date = document.getElementById('new-schedule-date').value;
            
            if (!title || !date) {
                alert('ì œëª©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            data.schedules.push({
                id: Date.now(),
                title: title,
                date: date,
                amount: Number(document.getElementById('new-schedule-amount').value) || 0,
                memo: document.getElementById('new-schedule-memo').value,
                status: 'ì˜ˆì •'
            });
            
            saveData();
            hideAddSchedule();
        }

        function deleteSchedule(id) {
            if (confirm('ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                var newSchedules = [];
                for (var i = 0; i < data.schedules.length; i++) {
                    if (data.schedules[i].id !== id) {
                        newSchedules.push(data.schedules[i]);
                    }
                }
                data.schedules = newSchedules;
                saveData();
            }
        }

        function toggleScheduleStatus(id) {
            for (var i = 0; i < data.schedules.length; i++) {
                if (data.schedules[i].id === id) {
                    data.schedules[i].status = data.schedules[i].status === 'ì™„ë£Œ' ? 'ì˜ˆì •' : 'ì™„ë£Œ';
                    break;
                }
            }
            saveData();
        }

        function showAddExpense() {
            document.getElementById('expense-modal').classList.add('active');
        }

        function hideAddExpense() {
            document.getElementById('expense-modal').classList.remove('active');
            document.getElementById('new-expense-item').value = '';
            document.getElementById('new-expense-budget').value = '';
            document.getElementById('new-expense-actual').value = '';
            document.getElementById('new-expense-memo').value = '';
            document.getElementById('new-expense-receipt').value = '';
        }

        function addExpenseItem() {
            var item = document.getElementById('new-expense-item').value;
            if (!item) {
                alert('í•­ëª©ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            var receiptFile = document.getElementById('new-expense-receipt').files[0];
            var receiptData = null;
            
            if (receiptFile) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    data.expenses.push({
                        id: Date.now(),
                        category: document.getElementById('new-expense-category').value,
                        item: item,
                        budget: Number(document.getElementById('new-expense-budget').value) || 0,
                        actual: Number(document.getElementById('new-expense-actual').value) || 0,
                        status: document.getElementById('new-expense-status').value,
                        memo: document.getElementById('new-expense-memo').value,
                        receipt: e.target.result
                    });
                    saveData();
                    hideAddExpense();
                };
                reader.readAsDataURL(receiptFile);
            } else {
                data.expenses.push({
                    id: Date.now(),
                    category: document.getElementById('new-expense-category').value,
                    item: item,
                    budget: Number(document.getElementById('new-expense-budget').value) || 0,
                    actual: Number(document.getElementById('new-expense-actual').value) || 0,
                    status: document.getElementById('new-expense-status').value,
                    memo: document.getElementById('new-expense-memo').value,
                    receipt: null
                });
                saveData();
                hideAddExpense();
            }
        }

        function deleteExpense(id) {
            if (confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                var newExpenses = [];
                for (var i = 0; i < data.expenses.length; i++) {
                    if (data.expenses[i].id !== id) {
                        newExpenses.push(data.expenses[i]);
                    }
                }
                data.expenses = newExpenses;
                saveData();
            }
        }


        function renderMonthlySavings() {
            var html = '';
            var currentYear = new Date().getFullYear();
            var months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            
            for (var month = 1; month <= 12; month++) {
                var monthTotal = 0;
                
                // í•´ë‹¹ ì›”ì˜ ëª¨ë“  ì €ì¶• ê¸°ë¡ í•©ì‚°
                for (var dateStr in data.savingRecords) {
                    var recordDate = new Date(dateStr);
                    if (recordDate.getFullYear() === currentYear && recordDate.getMonth() + 1 === month) {
                        monthTotal += data.savingRecords[dateStr];
                    }
                }
                
                var hasAmount = monthTotal > 0;
                var bgColor = hasAmount ? '#f0fdf4' : 'white';
                var borderColor = hasAmount ? '#10b981' : '#e2e8f0';
                
                html += '<div onclick="editMonthSaving(' + month + ')" style="';
                html += 'background: ' + bgColor + '; ';
                html += 'border: 2px solid ' + borderColor + '; ';
                html += 'border-radius: 12px; ';
                html += 'padding: 20px 16px; ';
                html += 'text-align: center; ';
                html += 'cursor: pointer; ';
                html += 'transition: all 0.2s; ';
                html += 'min-height: 90px; ';
                html += 'display: flex; ';
                html += 'flex-direction: column; ';
                html += 'justify-content: center; ';
                html += '" ';
                html += 'onmouseover="this.style.background=\'#dcfce7\'; this.style.borderColor=\'#059669\'; this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 12px rgba(16, 185, 129, 0.2)\';" ';
                html += 'onmouseout="this.style.background=\'' + bgColor + '\'; this.style.borderColor=\'' + borderColor + '\'; this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'none\';">';
                html += '<div style="font-size: 14px; font-weight: 600; color: #64748b; margin-bottom: 8px;">' + months[month - 1] + '</div>';
                html += '<div style="font-size: 18px; font-weight: 700; color: ' + (hasAmount ? '#059669' : '#94a3b8') + ';">' + formatNumber(monthTotal) + 'ë§Œì›</div>';
                html += '</div>';
            }
            
            document.getElementById('monthly-savings-grid').innerHTML = html;
        }

        function editMonthSaving(month) {
            var currentYear = new Date().getFullYear();
            var monthTotal = 0;
            var monthKey = currentYear + '-' + (month < 10 ? '0' + month : month);
            
            // í•´ë‹¹ ì›”ì˜ ì´ ì €ì¶•ì•¡ ê³„ì‚°
            for (var dateStr in data.savingRecords) {
                if (dateStr.startsWith(monthKey)) {
                    monthTotal += data.savingRecords[dateStr];
                }
            }
            
            var message = monthTotal > 0 
                ? month + 'ì›” í˜„ì¬ ê¸ˆì•¡: ' + formatNumber(monthTotal) + 'ë§Œì›\n\nìƒˆ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (0 ì…ë ¥ ì‹œ ì‚­ì œ):'
                : month + 'ì›” ì €ì¶• ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (ë§Œì›):';
            
            var newAmount = prompt(message, monthTotal);
            
            if (newAmount === null) return; // ì·¨ì†Œ
            
            newAmount = Number(newAmount);
            
            if (isNaN(newAmount) || newAmount < 0) {
                alert('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            // í•´ë‹¹ ì›”ì˜ ëª¨ë“  ê¸°ë¡ ì‚­ì œ
            for (var dateStr in data.savingRecords) {
                if (dateStr.startsWith(monthKey)) {
                    delete data.savingRecords[dateStr];
                }
            }
            
            // ìƒˆ ê¸ˆì•¡ì´ 0ë³´ë‹¤ í¬ë©´ í•´ë‹¹ ì›” 1ì¼ì— ì €ì¥
            if (newAmount > 0) {
                var saveDate = currentYear + '-' + (month < 10 ? '0' + month : month) + '-01';
                data.savingRecords[saveDate] = newAmount;
            }
            
            saveData();
        }

        function editSavingForDate(dateStr) {
            var currentAmount = data.savingRecords[dateStr] || 0;
            var message = currentAmount > 0 
                ? 'í˜„ì¬ ê¸ˆì•¡: ' + formatNumber(currentAmount) + 'ë§Œì›\n\nìƒˆ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (0 ì…ë ¥ ì‹œ ì‚­ì œ):'
                : 'ì €ì¶• ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (ë§Œì›):';
            
            var newAmount = prompt(message, currentAmount);
            
            if (newAmount === null) return; // ì·¨ì†Œ
            
            newAmount = Number(newAmount);
            
            if (isNaN(newAmount) || newAmount < 0) {
                alert('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            if (newAmount === 0) {
                // ì‚­ì œ
                delete data.savingRecords[dateStr];
            } else {
                // ì¶”ê°€/ìˆ˜ì •
                data.savingRecords[dateStr] = newAmount;
            }
            
            saveData();
        }

        function addSavingRecord() {
            var date = document.getElementById('saving-date').value;
            var amount = Number(document.getElementById('saving-amount').value);
            
            if (!date || !amount) {
                alert('ë‚ ì§œì™€ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            if (!data.savingRecords[date]) {
                data.savingRecords[date] = 0;
            }
            data.savingRecords[date] += amount;
            
            document.getElementById('saving-date').value = '';
            document.getElementById('saving-amount').value = '';
            saveData();
        }


        var budgetFields = ['base-price', 'interest', 'options', 'paid-deposit', 'cash', 'home-price', 'loan-deposit', 'loan-rate', 'ltv'];
        for (var i = 0; i < budgetFields.length; i++) {
            var field = budgetFields[i];
            var elem = document.getElementById('budget-' + field);
            elem.setAttribute('data-field', field);
            elem.addEventListener('input', function() {
                var fieldName = this.getAttribute('data-field').replace(/-([a-z])/g, function(g) { 
                    return g[1].toUpperCase(); 
                });
                data.budget[fieldName] = Number(this.value) || 0;
                saveData();
            });
        }

        document.getElementById('piggy-goal').addEventListener('input', function() {
            data.savingGoal = Number(this.value) || 0;
            saveData();
        });

        loadData();
    </script>
</body>
</html>